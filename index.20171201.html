<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/crowdsourcedscores-icon.png">
    <link rel="icon" type="image/png" href="assets/img/crowdsourcedscores-icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="description" content="Crowdsourced NFL Score Predictions">
    <meta name="keywords" content="football,crowdsourced,wisdom,wisdom of the crowd,sportsbook,spread,total,moneyline">
    <base href="http://crowdsourcedscores.com">

    <title>Crowdsourced Scores - Predict NFL Games</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>

    <!--     Fonts and icons     -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css"/>

    <!-- CSS Files -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="assets/css/material-kit.css" rel="stylesheet"/>
    <style type="text/css">
        .card .content {
            padding-left:5px;
            padding-right: 5px;
        }
        .table > thead > tr > th,
        .table > thead > tr > td {
            padding: 5px;
            text-align: center;
        }
        .container {
            padding-left: 5px;
            padding-right: 5px;
        }
        .form-control {
            /*padding-left:27px;
            padding-top: 9px;*/
            padding: 0;
            margin: 0 7px;
            text-align: center;
            height: auto;
            /*border: 1px solid #B22438;
            background-color: #B22438;
            color: #fff;*/
            background-image: linear-gradient(#9c27b0, #9c27b0), linear-gradient(#B22438, #B22438);
        }
        #fbSection {
            margin: 5px 10px;
        }
        #fbSection img {
            float:left;
            padding-right: 10px;
        }
        .fbName {
            margin: 10px 0;
        }
        /* Dropdown Button */
        .dropbtn {
            background-color: #4CAF50;
            color: white;
            padding: 16px;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        /* The container <div> - needed to position the dropdown content */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        /* Dropdown Content (Hidden by Default) */
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }

        /* Links inside the dropdown */
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        /* Change color of dropdown links on hover */
        .dropdown-content a:hover {background-color: #f1f1f1}

        /* Show the dropdown menu on hover */
        .dropdown:hover .dropdown-content {
            display: block;
        }

        /* Change the background color of the dropdown button when the dropdown content is shown */
        .dropdown:hover .dropbtn {
            background-color: #3e8e41;
        }

        .navbar, .navbar.navbar-default {
            background-color: #3A3B6C;
        }

        .header-icon {
            float:left;
            margin-right:10px;
        }
        .header-icon img {
            width: 60px;
        }
        .topRow {
            padding-top: 90px;
        }
        .gameHeaderPredicted {
            background-color:#3A3B6C;
            color:#fff;
        }
        .gameHeaderNotPrediction {
            border:1px solid #3A3B6C;
        }

        .crowdCorrect {
            color: #55b559;
            font-weight: bold;
        }

        .crowdHidden {
            visibility: hidden;
        }

        #resultsContainer {
            color:#fff;
            display:none;
            font-weight: bold;
            font-size: 1.2em;
            padding-bottom: 15px;
        }
        #myResultsRow {
            background-color: #B42135;
            border: 1px solid #B42135;
            margin: 0 15px;
        }

        #crowdResultsRow {
            background-color:#3A3B6C;
            color:#fff;
            margin: 0 15px;
        }

        .finalRow {
            background-color: #000;
            color:#fff;
            font-weight: bold;
            font-size: 1.1em;
            padding: 5px 15px;
            text-align: center;
        }
        #chartExpand {
            padding-top: 8px;
        }
        #weeklyChart {
            
            padding: 5px;
        }
        #weeklyChartButton {
            color: #fff;
            background-color: #B42135;
            margin: 0 auto;
            float: right;
        }
        #overallChartButton {
            color: #fff;
            background-color: #3A3B6C;
            margin: 0 auto;
        }

        @media(max-width:768px) {
            #resultRow {
                text-align: center;
            }
        }

    </style>


    <!--   Core JS Files   -->
    <script src="assets/js/jquery.min.js" type="text/javascript"></script>
    <script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="assets/js/material.min.js"></script>

    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="assets/js/nouislider.min.js" type="text/javascript"></script>

    <!--  Plugin for the Datepicker, full documentation here: http://www.eyecon.ro/bootstrap-datepicker/ -->
    <script src="assets/js/bootstrap-datepicker.js" type="text/javascript"></script>

    <!-- Control Center for Material Kit: activating the ripples, parallax effects, scripts from the example pages etc -->
    <script src="assets/js/material-kit.js" type="text/javascript"></script>

    
    
    <script>
            //Auth0 Google Analytics script
                    // 'google-analytics': {
                    //     id: 'UA-69748662-2'
                    // }
                    // preloaded: true
            
        window.auth0AnalyticsOptions = {
            'google-analytics': {
                id: 'UA-69748662-2'
            }
        }
        
    </script>
        <!-- Auth0 lock script -->
        <script src="//cdn.auth0.com/js/lock/10.15/lock.min.js"></script>
        <script src="//cdn.auth0.com/js/analytics/1.3.0/analytics.min.js"></script>
        <!--End Auth0 Google Analytics script-->

        <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
                
                ga('create', 'UA-69748662-2', 'auto');
                ga('send', 'pageview');
            </script>
    <!-- Handlebars.js -->
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.js"></script>
            <script type="text/javascript">


        Handlebars.registerHelper('grouped_each', function(every, context, options) {
            var out = "", subcontext = [], i;
            if (context && context.length > 0) {
                for (i = 0; i < context.length; i++) {
                    if (i > 0 && i % every === 0) {
                        out += options.fn(subcontext);
                        subcontext = [];
                    }
                    subcontext.push(context[i]);
                }
                out += options.fn(subcontext);
            }
            return out;
        });

        Handlebars.registerHelper('ifCond', function (v1, operator, v2, options) {

            switch (operator) {
                case '==':
                    return (v1 == v2) ? options.fn(this) : options.inverse(this);
                case '===':
                    return (v1 === v2) ? options.fn(this) : options.inverse(this);
                case '!=':
                    return (v1 != v2) ? options.fn(this) : options.inverse(this);
                case '!==':
                    return (v1 !== v2) ? options.fn(this) : options.inverse(this);
                case '<':
                    return (v1 < v2) ? options.fn(this) : options.inverse(this);
                case '<=':
                    return (v1 <= v2) ? options.fn(this) : options.inverse(this);
                case '>':
                    return (v1 > v2) ? options.fn(this) : options.inverse(this);
                case '>=':
                    return (v1 >= v2) ? options.fn(this) : options.inverse(this);
                case '&&':
                    return (v1 && v2) ? options.fn(this) : options.inverse(this);
                case '||':
                    return (v1 || v2) ? options.fn(this) : options.inverse(this);
                default:
                    return options.inverse(this);
            }
        });
            </script>

    <script id="games-template" type="text/x-handlebars-template">
        <div class="container">
            <div class="row">
            {{#grouped_each 3 games}}
                {{#each this}}
                <div class="col-md-4 col-sm-12 col-xs-12" id="container-{{{gameId}}}">
                    <div class="card prediction" style="margin-bottom:10px;min-width: 293px;" data-game-id="{{{gameId}}}"
                        data-game-week="{{{gameWeek}}}"
                        data-game-year="{{{year}}}"
                        data-home-code="{{{homeTeam.code}}}"
                        data-home-name="{{{homeTeam.fullName}}}" data-home-short="{{{homeTeam.shortName}}}"
                        data-away-code="{{{awayTeam.code}}}"
                        data-away-name="{{{awayTeam.fullName}}}" data-away-short="{{{awayTeam.shortName}}}"
                        style="display: inline-block;">
                        <div class="content">
                            <div class="tab-content text-center">
                                <div class="tab-pane active">
                                    <div class="prediction-message" data-game-id="{{{gameId}}}"></div>
                                    <div>
                                        <div class="form-group">
                                            <p{{#if prediction}} class="gameHeaderPredicted"{{/if}}{{#unless prediction}} class="gameHeaderNotPredicted"{{/unless}}>Game {{gameId}}<br/>{{startDateTime}}<br/>{{tvStation}}</p>
                                        </div>
                                    </div>

                                        {{#if results}}<div class="finalRow">FINAL</div>{{/if}}

                                    {{#if crowd}}
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th></th>
                                            <th>Me</th>
                                            <th>The Crowd</th>
                                            <th>Odds</th>
                                            <th>{{#unless results}}Pick{{/unless}}{{#if results}}Actual{{/if}}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>{{awayTeam.code}}</td>
                                            <td class="away-team-prediction {{#if results}}{{#ifCond results.awayTeam.score '>' results.homeTeam.score}}{{#ifCond prediction.awayTeam.score '>' prediction.homeTeam.score}} alert alert-success{{/ifCond}}{{/ifCond}}{{/if}}" id="{{{awayTeam.code}}}-prediction">
                                                {{#unless results}}
                                                    <input type="number" min="0" max="50" class="form-control" placeholder="##"
                                                    value="{{prediction.awayTeam.score}}">
                                                {{/unless}}
                                                {{#if results}}
                                                    {{prediction.awayTeam.score}}
                                                {{/if}}
                                            </td>
                                            <td{{#if results}}{{#ifCond results.awayTeam.score '>' results.homeTeam.score}}{{#ifCond crowd.awayTeam.score '>' crowd.homeTeam.score}} class="crowdCorrect"{{/ifCond}}{{/ifCond}}{{/if}}>
                                                <span
                                                    {{#unless prediction}}
                                                        {{#unless results}}
                                                            class="crowdHidden"
                                                        {{/unless}}
                                                    {{/unless}}>
                                                    {{crowd.awayTeam.score}}
                                                </span>
                                                {{#unless prediction}}
                                                    {{#unless results}}
                                                        <span class="fa fa-lock crowdShown"></span>
                                                    {{/unless}}
                                                {{/unless}}</td>
                                            <td></td>
                                            <td>{{results.awayTeam.score}}</td>
                                        </tr>
                                        <tr>
                                            <td>{{homeTeam.code}}</td>
                                            <td class="home-team-prediction{{#if results}}{{#ifCond results.homeTeam.score '>' results.awayTeam.score}}{{#ifCond prediction.homeTeam.score '>' prediction.awayTeam.score}} alert alert-success{{/ifCond}}{{/ifCond}}{{/if}}" id="{{{homeTeam.code}}}-prediction">
                                                {{#unless results}}
                                                    <input type="number" min="0" max="50" class="form-control" placeholder="##"
                                                    value="{{prediction.homeTeam.score}}">
                                                {{/unless}}
                                                {{#if results}}
                                                    {{prediction.homeTeam.score}}
                                                {{/if}}
                                            </td>
                                            <td
                                                {{#if results}}
                                                    {{#ifCond results.homeTeam.score '>' results.awayTeam.score}}
                                                        {{#ifCond crowd.homeTeam.score '>' crowd.awayTeam.score}}
                                                         class="crowdCorrect"
                                                        {{/ifCond}}
                                                    {{/ifCond}}
                                                {{/if}}>
                                                <span
                                                    {{#unless prediction}}
                                                        {{#unless results}}
                                                         class="crowdHidden"
                                                        {{/unless}}
                                                    {{/unless}}
                                                >{{crowd.homeTeam.score}}</span>
                                                {{#unless prediction}}
                                                    {{#unless results}}
                                                        <span class="fa fa-lock crowdShown"></span>
                                                    {{/unless}}
                                                {{/unless}}
                                            </td>
                                            <td>
                                                    <span
                                                        {{#unless prediction}}
                                                            {{#unless results}}
                                                             class="crowdHidden"
                                                            {{/unless}}
                                                        {{/unless}}
                                                    >
                                                    {{#ifCond odds.spread '>' 0}}+{{/ifCond}}{{odds.spread}}
                                                    </span>
                                            </td>
                                            <td>{{results.homeTeam.score}}</td>
                                        </tr>
                                        <tr>
                                            <td>Total</td>
                                            <td{{#if results}}
                                                {{#ifCond prediction.total '>' odds.total}}
                                                    {{#ifCond results.total '>' odds.total}}
                                                         class="alert alert-success"
                                                    {{/ifCond}}
                                                {{/ifCond}}
                                                {{#ifCond odds.total '>' prediction.total}}
                                                    {{#ifCond odds.total '>' results.total}}
                                                     class="alert alert-success"
                                                    {{/ifCond}}
                                                {{/ifCond}}
                                            {{/if}} id="{{{awayTeam.code}}}{{{homeTeam.code}}}-total-prediction">{{prediction.total}}</td>
                                            <td{{#if results}}{{#ifCond crowd.total '>' odds.total}}{{#ifCond results.total '>' odds.total}} class="crowdCorrect"{{/ifCond}}{{/ifCond}}{{#ifCond odds.total '>' crowd.total}}{{#ifCond odds.total '>' results.total}} class="crowdCorrect"{{/ifCond}}{{/ifCond}}{{/if}}><span{{#unless prediction}}{{#unless results}} class="crowdHidden"{{/unless}}{{/unless}}>{{crowd.total}}</span>{{#unless prediction}} {{#unless results}}<span class="fa fa-lock crowdShown"></span>{{/unless}} {{/unless}}</td>
                                            <td>
                                                <span
                                                    {{#unless prediction}}
                                                        {{#unless results}}
                                                         class="crowdHidden"
                                                        {{/unless}}
                                                    {{/unless}}>{{odds.total}}</span></td>
                                            <td>
                                                {{#unless results}}
                                                <span
                                                    {{#unless prediction}}
                                                        {{#unless results}}
                                                         class="crowdHidden"
                                                        {{/unless}}
                                                    {{/unless}}
                                                 style="font-weight:bold">{{#ifCond odds.total '!=' ""}}{{#ifCond crowd.total '>' odds.total}}Over{{/ifCond}}{{#ifCond crowd.total '<' odds.total}}Under{{/ifCond}}{{/ifCond}}</span>{{/unless}}{{#if results}}{{results.total}}{{/if}}</td>
                                        </tr>
                                        <tr>
                                            <td>Spread</td>
                                            <td{{#if results}}{{#ifCond prediction.results.spread '===' 1}} class="alert alert-success"{{/ifCond}}{{/if}} id="{{{awayTeam.code}}}{{{homeTeam.code}}}-spread-prediction">{{#ifCond prediction.spread '>' 0}}+{{/ifCond}}{{prediction.spread}}</td>
                                            <td{{#if results}}{{#ifCond crowd.spread '>' odds.spread}}{{#ifCond results.spread '>' odds.spread}} class="crowdCorrect"{{/ifCond}}{{/ifCond}}{{#ifCond odds.spread '>' crowd.spread}}{{#ifCond odds.spread '>' results.spread}} class="crowdCorrect"{{/ifCond}}{{/ifCond}}{{/if}}>
                                                <span
                                                    {{#unless prediction}}
                                                        {{#unless results}}
                                                         class="crowdHidden"
                                                        {{/unless}}
                                                    {{/unless}}>{{#ifCond crowd.spread '>' 0}}+{{/ifCond}}{{crowd.spread}}</span>{{#unless prediction}}{{#unless results}}<span class="fa fa-lock crowdShown"></span>{{/unless}}{{/unless}}</td>
                                            <td>
                                                    <span
                                                        {{#unless prediction}}
                                                            {{#unless results}}
                                                             class="crowdHidden"
                                                            {{/unless}}
                                                        {{/unless}}
                                                    >
                                                    {{#ifCond odds.spread '!=' 0}}{{#ifCond odds.spread '>' 0}}+{{/ifCond}}{{odds.spread}}{{/ifCond}}{{#ifCond odds.spread '===' 0}}Even{{/ifCond}}</span></td>
                                            <td>
                                                {{#unless results}}
                                                    <span
                                                        {{#unless prediction}}
                                                            {{#unless results}}
                                                             class="crowdHidden"
                                                            {{/unless}}
                                                        {{/unless}}
                                                        style="font-weight:bold">{{#ifCond odds.spread '!=' ""}}{{#ifCond crowd.spread '>' odds.spread}}{{awayTeam.code}}{{/ifCond}}{{#ifCond crowd.spread '<' odds.spread}}{{homeTeam.code}}{{/ifCond}}{{/ifCond}}
                                                    </span>
                                                {{/unless}}{{#if results}}{{results.spread}}{{/if}}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    {{/if}}

                                    {{#unless results}}
                                    <div>
                                        <button class="prediction-btn btn btn-info">Predict</button>
                                    </div>
                                    {{/unless}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {{/each}}
                <div class="clearfix"></div>
            {{/grouped_each}}
        </div>
        <div id="lastRow" class="row"></div>
        </div>
    </script>

    <script type="text/javascript">
        var lockOptions = {
            closable: false,
            auth: {
                params: {scope: 'openid email'}
            },
            theme: {
                logo: 'https://s3-us-west-2.amazonaws.com/crowdsourcedscores.com/assets/img/crowdsourcedscores-icon.png',
                primaryColor: '#3B3D6B'
            }
        };

        var lock = null;

        lock = new Auth0Lock('DGGRh6nxG2FfQlDorkqHLRQVqMAaC3uI', 'pcsm.auth0.com', lockOptions);

        btn_login = $('.auth0-lock-social-button.auth0-lock-social-big-button');
        // $('.auth0-lock-social-button.auth0-lock-social-big-button').click(function() {
        //         ga('send','event','login','clicked');
        // });

        var userProfile;
        //function authenticateUser() {
            lock.on("authenticated", function (authResult) {
                ga('send','event','login','successful');
                localStorage.setItem('id_token', authResult.idToken);

                var id_token = localStorage.getItem('id_token');

                if (id_token) {
                    getUserProfile(authResult.idToken, function (error, profile) {
                        if (error) {
                            // Handle error
                            return;
                        } else {

                        localStorage.setItem('id_token', authResult.idToken);

                        localStorage.setItem('profile', JSON.stringify(profile));

                        userProfile = profile;
                        setUserProfile(profile);
                        }
                    });
                }
            });
            if (!userProfile) {
                id_token = localStorage.getItem('id_token');
                
                lock.getProfile(id_token, function (error, profile) {
                    if (error) {
                        return;
                    } else {
                        userProfile = profile;
                        setUserProfile(profile);
                    }
                });

            }
        //}
        // if (localStorage.getItem('profile')) {
        //     setUserProfile(localStorage.getItem('profile'));
        // }

        var getGameWeek = function (callback) {
            var id_token = localStorage.getItem('id_token') || "";

            $.ajax({
                url: "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/week",
                type: "GET",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader('Authorization', id_token);
                },
                success: function (data) {
                    console.log(JSON.stringify(data));
                    return callback(null, data);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("Error getting game week")
                    if (jqXHR.status == 0) {
                        lock.show();
                    }
                }
            });
        }

        var formatGameTimes = function (games) {
            for (var i = 0; i < games.length; i++) {
                var gameDate = new Date(games[i].startDateTime);
                var options = { weekday: 'long', year: 'numeric', month: '2-digit', day: '2-digit', hour: 'numeric', minute: 'numeric', timeZoneName: 'short' };
                games[i].startDateTime = gameDate.toLocaleString('en-US', options);
            }
            return games;
        }


        // setting user weekly results
        var getWeeklyResults = function(data) {
            var myStraightUpResults = 0;
            var mySpreadResults = 0;
            var myTotalResults = 0;
            if (data && data.length > 0) {
                for (i = 0; i < data.length; i++) {
                    if (data[i].prediction && data[i].prediction.results) {
                        $("#resultsContainer").css("display","block");
                        if (data[i].prediction.results.winner) {myStraightUpResults += data[i].prediction.results.winner;}
                        if (data[i].prediction.results.spread) {mySpreadResults += data[i].prediction.results.spread;}
                        if (data[i].prediction.results.total) {myTotalResults += data[i].prediction.results.total;}
                    }
                }
                $("#myStraightUpResults").text(myStraightUpResults);
                $("#mySpreadResults").text(mySpreadResults);
                $("#myTotalResults").text(myTotalResults);
            }
        }
        var getLeaderboards = function(data) {
            var myStraightUpResults = 0;
            var mySpreadResults = 0;
            var myTotalResults = 0;
            if (data && data.length > 0) {
                for (i = 0; i < data.length; i++) {
                    if (data[i].prediction && data[i].prediction.results) {
                        $("#resultsContainer").css("display","block");
                        if (data[i].prediction.results.winner) {myStraightUpResults += data[i].prediction.results.winner;}
                        if (data[i].prediction.results.spread) {mySpreadResults += data[i].prediction.results.spread;}
                        if (data[i].prediction.results.total) {myTotalResults += data[i].prediction.results.total;}
                    }
                }
                $("#myStraightUpResults").text(myStraightUpResults);
                $("#mySpreadResults").text(mySpreadResults);
                $("#myTotalResults").text(myTotalResults);
            }
        }

        var getWeeklyCrowdResults = function(crowdData) {
            var crowdStraightUpResults = 0;
            var crowdSpreadResults = 0;
            var crowdTotalResults = 0;
            if (crowdData && crowdData.length > 0) {
                for (i = 0; i < crowdData.length; i++) {
                    if (crowdData[i].crowd && crowdData[i].crowd.results) {
                        $("#resultsContainer").css("display","block");
                        if (crowdData[i].crowd.results.winner && crowdData[i].crowd.results.winner.correct) {crowdStraightUpResults += crowdData[i].crowd.results.winner.correct;}
                        if (crowdData[i].crowd.results.spread && crowdData[i].crowd.results.spread.correct) {crowdSpreadResults += crowdData[i].crowd.results.spread.correct;}
                        if (crowdData[i].crowd.results.total && crowdData[i].crowd.results.total.correct) {crowdTotalResults += crowdData[i].crowd.results.total.correct;}
                    }
                }
                $("#crowdStraightUpResults").text(crowdStraightUpResults);
                $("#crowdSpreadResults").text(crowdSpreadResults);
                $("#crowdTotalResults").text(crowdTotalResults);
            }            
        }

        var setGameWeek = function (year, week) {
            var id_token = localStorage.getItem('id_token') || "";

            $.ajax({
                url: "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/" + year + "/" + week + "/games",
                type: "GET",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader('Authorization', id_token);
                },
                success: function (data) {
                    formatGameTimes(data);
                    var games = {games: data};
                    var template = $('#games-template').html();
                    var templateScript = Handlebars.compile(template);
                    var html = templateScript(games);
                    $('#games').html(html);
                    getWeeklyResults(data);
                    getWeeklyCrowdResults(data);
                    //drawChart2(year, week);
                    $('.prediction-btn').on('click', function (e) {
                        e.preventDefault();
                        $(this).text('Saving...');
                        var $prediction = $(this).parents('.prediction');
                        var prediction = {
                            gameId: $prediction.attr('data-game-id'),
                            gameWeek: $prediction.attr('data-game-week'),
                            year: $prediction.attr('data-game-year'),
                            awayTeam: {
                                code: $prediction.attr('data-away-code'),
                                fullName: $prediction.attr('data-away-name'),
                                shortName: $prediction.attr('data-away-short')
                            },
                            homeTeam: {
                                code: $prediction.attr('data-home-code'),
                                fullName: $prediction.attr('data-home-name'),
                                shortName: $prediction.attr('data-home-short')
                            }
                        };

                        var awayTeamPrediction = $prediction.find('.away-team-prediction input').val();
                        var homeTeamPrediction = $prediction.find('.home-team-prediction input').val();

                        var away = $prediction.attr('data-away-team');
                        var home = $prediction.attr('data-home-team');

                        var awayCode = $prediction.attr('data-away-code');
                        var homeCode = $prediction.attr('data-home-code');

                        prediction.awayTeam.score = parseInt(awayTeamPrediction);
                        prediction.homeTeam.score = parseInt(homeTeamPrediction);

                        submitPrediction(prediction, $(this));
                        // Update prediction table cell
                        //$('#' + awayCode + '-prediction').text(prediction.awayTeam.score);
                        //$('#' + homeCode + '-prediction').text(prediction.homeTeam.score);
                        $('#' + awayCode + homeCode + '-total-prediction').text(prediction.awayTeam.score + prediction.homeTeam.score);
                        $('#' + awayCode + homeCode + '-spread-prediction').text(prediction.awayTeam.score - prediction.homeTeam.score);
                        //show odds and crowd info
                        $prediction.find('.crowdHidden').removeClass('crowdHidden');
                        $prediction.find('.crowdShown').addClass('crowdHidden').removeClass('crowdShown');
                    });
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("Error getting games");
                    if (jqXHR.status == 0) {
                        lock.show();
                    }
                }
            });

                

            
            
        };

        //jQuery for animating boxes after they're predicted

            function moveBoxes(gameId) {
                $("#container-" + gameId).animate({opacity: '0.1'}, 1500, function() {
                    var predictedGame = $("#container-" + gameId).detach();
                    $("#lastRow").append(predictedGame);
                });
                $("#container-" + gameId).animate({opacity: '1.0'}, 1500);
            }

        var submitPrediction = function (prediction, btn) {
            var id_token = localStorage.getItem('id_token');
            var predictionElm = $('#games').find("[data-game-id='" + prediction.gameId + "']");
            var messageElm = predictionElm.find(".prediction-message");

            ga('send','event','prediction','submitted',prediction.gameId);
            $.ajax({
                url: "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/predictions",
                type: "POST",
                data: JSON.stringify(prediction),
                beforeSend: function (xhr) {
                    xhr.setRequestHeader('Authorization', id_token);
                    xhr.setRequestHeader('Content-Type', 'application/json');
                },
                statusCode: {
                    200: function (response) {
                        console.log("200: ", response);
                        btn.text('Predict');
                        var messageHtml = statusMessage('success', response.message);
//                        predictionElm.append(messageHtml);
                        messageElm.html(messageHtml)
                        moveBoxes(prediction.gameId);

                    },
                    400: function (response) {
                        var errorObj = JSON.parse(response.responseText);
                        console.log("400: ", errorObj);
                        btn.text('Predict');
                        var messageHtml = statusMessage('danger', errorObj.message);
                        //predictionElm.append(messageHtml);
                        messageElm.html(messageHtml)
                    },
                    500: function (response) {
                        var errorObj = JSON.parse(response.responseText);
                        console.log("500: ", errorObj);
                        btn.text('Predict');
                        var messageHtml = statusMessage('danger', errorObj.message);
//                        predictionElm.append(messageHtml);
                        messageElm.html(messageHtml)

                    }
                }
            });
        };

        var statusMessage = function (type, message) {
            var icon = type === 'success' ? 'check' : 'error_outline';
            var head = type === 'success' ? 'Success' : 'Error';
            return '<div class="alert alert-' + type + '" style="padding:5px;"> \
                                <div class="container-fluid"> \
                                <div class="alert-icon"> \
                                <i class="material-icons">' + icon + '</i> \
                                </div> \
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close"> \
                                <span aria-hidden="true"><i class="material-icons">clear</i></span> \
                                </button> \
                                <b>' + head + '</b> ' + message + '\
                        </div> \
                        </div>';
        };

        var getUserProfile = function (id_token, callback) {
            lock.getProfile(id_token, function (err, profile) {
                if (err) {
                    return callback('There was an error getting the profile: ' + err.message);
                }

                return callback(null, profile);
            });
        };

        var setUserProfile = function (profile) {
            // Display user information in the UI somewhere
            
            // Used for editing
            var user_id = profile.user_id;
            // ...
            //document.getElementById('avatar').src = profile.picture;

        };

        var logout = function() {
            localStorage.removeItem('id_token');
            localStorage.removeItem('profile');
            window.location.href = "/";
        };


        $(document).ready(function () {
            $('#weekSelector li').on('click', 'a', function () {
                var year = parseInt(document.getElementById('seasonSelector').value);
                var week = parseInt($(this).attr('data-week'));
                $('#weekSelector li').removeClass('active');
                $('#resultsContainer').css('display','none');
                $(this).parent('li').addClass('active');
                setGameWeek(year, week);
            });

            setTimeout(function () {
                getGameWeek(function (err, data) {
                    if (data) {
                        week = data.week;
                        year = parseInt(document.getElementById('seasonSelector').value);
                        if (data.year) {
                            year = data.year;
                        }
                        var $selectorElm = $('*[data-week="' + week + '"]');
                        $selectorElm.parent('li').addClass('active');
                        setGameWeek(year, week);
                    }
                });
            }, 1000);
            
            $('#weeklyChartButton').click(function () {
                drawChart2(2017, null, "weekly");
            });
            $('#overallChartButton').click(function () {
                drawChart2(2017, null, "overall")
            });
            

            if (userProfile) {document.getElementById('profileName').innerText = userProfile.name;}
            
            $("#chartExpand").click(function () {

                $header = $(this);
                //getting the next element
                $content = $("#weeklyChart");
                //open up the content needed - toggle the slide- if visible, slide up, if not slidedown.
                $content.slideToggle(500, function () {
                    //execute this after slideToggle is done
                    //change text of header based on visibility of content div
                    $header.text(function () {
                        //change text based on condition
                        //return $content.is(":visible") ? "" : "";
                    });
                });

            });


            var btn_logout = document.getElementById('btn-logout');

            // btn_login.addEventListener('click', function() {
            // lock.show();
            // });

            btn_logout.addEventListener('click', function() {
            logout();
            });
        });

    </script>
    <script src="https://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
        google.load("visualization", "1", {packages:["corechart"]});
        google.setOnLoadCallback(drawChart2);
        var id_token = localStorage.getItem('id_token') || "";
        // console.log("year: ", year);
        // console.log("week: ", week);
        var weeklyResultsData = (function() {
            var resultsJSON;
            $.ajax({
                // url: "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/" + year + "/" + week + "/leaderboards",
                url: "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/2017/13/leaderboards",
                type: "GET",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader('Authorization', id_token);
                },
                success: function (data) {
                    resultsJSON = data;
                    console.log("resultsJSON: ", resultsJSON);
                },
                error: function (textStatus, errorThrown) {
                    console.log("Error: ", errorThrown);
                }
            });
            console.log("resultsJSON: ",resultsJSON);
            return resultsJSON;
                   
        
        })();

        console.log("weeklyResultsData: ", weeklyResultsData);
            function drawChart2(year, week, view) {
                // year = year being viewed
                // week = week being viewed
                // view = weekly or overall view

                var week, year;
                if (!year) { 
                    getGameWeek(function (err, data) {
                        if (data) {
                            if (data.year) {
                                year = data.year;
                            }
                        }
                    });
                }
                if (!week) { 
                    getGameWeek(function (err, data) {
                        if (data) {
                            if (data.week) {
                                year = data.week;
                            }
                        }
                    });
                }
                    if (!view) { view = "weekly";}
                    //var chartData = $(weeklyResultsData.getChartData());
                    var chartData = {
                        weekly: [
                            ["Week","S/U","ATS","O/U","Total Games"],
                            [1,8,5,9,15],
                            [2,12,5,10,16],
                            [3,8,6,7,16],
                            [4,10,12,10,16],
                            [5,7,8,7,14],
                            [6,6,5,6,14],
                            [7,11,8,4,15],
                            [
                            8,
                            11,
                            5,
                            8,
                            13
                            ],
                            [
                            9,
                            8,
                            8,
                            7,
                            13
                            ],
                            [
                            10,
                            11,
                            7,
                            5,
                            14
                            ],
                            [
                            11,
                            10,
                            6,
                            6,
                            14
                            ],
                            [
                            12,
                            14,
                            8,
                            10,
                            16
                            ]
                        ],
                        overall: [
                            ["Week","S/U","ATS","O/U"],
                            [1,53,33,60],
                            [2,64,32,61],
                            [3,59,34,55],
                            [4,60,45,57],
                            [5,58,47,55],
                            [6,56,45,53],
                            [7,58,47,50],
                            [
                            8,
                            61,
                            46,
                            51
                            ],
                            [
                            9,
                            61,
                            48,
                            51
                            ],
                            [
                            10,
                            63,
                            48,
                            50
                            ],
                            [
                            11,
                            63,
                            48,
                            49
                            ],
                            [
                            12,
                            65,
                            48,
                            50
                            ]
                    ]
                }
                    var weeklyResults = {results: chartData.weekly};
                    var overallResults = {results: chartData.overall};
                    console.log("data: ",chartData);
                    console.log("weeklyResults: ",weeklyResults);
                    var data = google.visualization.arrayToDataTable(weeklyResults.results);
                    if (view === "overall") {
                        data = google.visualization.arrayToDataTable(overallResults.results);
                        console.log("overallResults: ", overallResults);
                    }
                    var options = {
                        weekly: {
                            title: 'Crowd Week-by-Week Performance',
                            hAxis: {title: 'Week',  titleTextStyle: {color: '#333'}},
                            vAxis: {minValue: 0,
                                    maxValue:12},
                            seriesType: 'bars',
                            series: {3: {type: 'line'}},
                            colors: ['#B42135', '#3A3B6C', '#A3A3A4','#000'],
                            legend: {position: 'bottom'}
                        },
                        overall: {
                            title: 'Crowd Week-by-Week Percent Correct',
                            hAxis: {title: 'Week',  titleTextStyle: {color: '#333'}},
                            vAxis: {minValue: 0,
                                    maxValue:100},
                            seriesType: 'line',
                            colors: ['#B42135', '#3A3B6C', '#A3A3A4'],
                            legend: {position: 'bottom'}
                        }
                    };

                var chart = new google.visualization.ComboChart(document.getElementById('weeklyChart'));
                chart.draw(data, options[view]);
            }
        //var data = google.visualization.arrayToDataTable(weeklyResults.results);
        // [
        //     ['Week', 'S/U', 'ATS', 'O/U', 'Total Games'],
        //     ['1',8,5,9,15],
        //     ['2',12,5,10,16],
        //     ['3',8,6,7,16],
        //     ['4',10,12,10,16],
        //     ['5',7,8,7,14],
        //     ['6',7,5,5,14],
        //     ['7',11,8,4,15],
        //     ['8',11,5,8,13],
        //     ['9',6,7,7,13]
        //     ]

            
                

            $(window).resize(function(){
            drawChart2(year, week);
            });

        </script>

    </head>

    <body>

    <!-- Navbar will come here -->

    <!-- end navbar -->

    <div class="wrapper">
        <!--<div class="header">-->

        <!--</div>-->
        <!-- you can use the class main-raised if you want the main area to be as a page with shadows -->
        <div class="main">
            <div class="container">
                <div class="row">
                    <div class="navbar navbar-default navbar-fixed-top">
                        <div class="container">
                            <div class="header-icon"><img src="https://crowdsourcedscores.files.wordpress.com/2016/11/cropped-css-logo-footballleft-webres-1300px.jpg?w=520" alt="Crowdsourced Scores"></div>
                            <div class="navbar-header"><a href="/" class="navbar-brand"><span class="hidden-xs">Crowdsourced Scores</span><span class="visible-xs">CS Scores</span></a>
                            <button type="button" data-toggle="collapse" data-target="#navbar-main" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
                            </div>
                            <div id="navbar-main" class="navbar-collapse collapse">
                            <ul class="nav navbar-nav">
                                <li class="active"><a href="#">Home</a></li>
                                <li><a href="https://blog.crowdsourcedscores.com/" target="blog">Blog</a></li>
                                <li><a href="http://blog.crowdsourcedscores.com/2017-leaderboards/" target="leaderboard">Leaderboards</a></li>
                                <li class="dropdown">
                                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="profileName"><span class="caret"></span></a>
                                    <ul class="dropdown-menu">
                                        <li style="text-align: center"><button type="button" class="btn btn-default" id="btn-logout">Logout</button></li>
                                    </ul>
                                </li>
                            </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row topRow">
                    <div class="col-xs-7 col-sm-10">


                        <select class="dropdown" id="seasonSelector">
                            <option value="2017" selected>2017</option>
                            <option value="2016">2016</option>
                        </select>
                        <h4>Select Week</h4>
                    </div>
                    <div class="col-xs-5 col-sm-2">
                        <a href="https://twitter.com/sourcedscores" class="twitter-follow-button" data-show-count="false">Follow @sourcedscores</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><br>
                        <iframe src="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Fcrowdsourcedscores&width=20px&layout=button_count&action=like&size=small&show_faces=false&share=true&height=46&appId=220211628373013" width="160px" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12 weekSelector">

                        <ul id="weekSelector" class="pagination pagination-info">
                            <li><a href="javascript:void(0);" data-week="1">1</a></li>
                            <li><a href="javascript:void(0);" data-week="2">2</a></li>
                            <li><a href="javascript:void(0);" data-week="3">3</a></li>
                            <li><a href="javascript:void(0);" data-week="4">4</a></li>
                            <li><a href="javascript:void(0);" data-week="5">5</a></li>
                            <li><a href="javascript:void(0);" data-week="6">6</a></li>
                            <li><a href="javascript:void(0);" data-week="7">7</a></li>
                            <li><a href="javascript:void(0);" data-week="8">8</a></li>
                            <li><a href="javascript:void(0);" data-week="9">9</a></li>
                            <li><a href="javascript:void(0);" data-week="10">10</a></li>
                            <li><a href="javascript:void(0);" data-week="11">11</a></li>
                            <li><a href="javascript:void(0);" data-week="12">12</a></li>
                            <li><a href="javascript:void(0);" data-week="13">13</a></li>
                            <li><a href="javascript:void(0);" data-week="14">14</a></li>
                            <li><a href="javascript:void(0);" data-week="15">15</a></li>
                            <li><a href="javascript:void(0);" data-week="16">16</a></li>
                            <li><a href="javascript:void(0);" data-week="17">17</a></li>                        
                            <!--<li><a href="javascript:void(0);" data-week="18">WC</a></li>
                            <li><a href="javascript:void(0);" data-week="19">DIV</a></li>
                            <li><a href="javascript:void(0);" data-week="20">CONF</a></li>
                            <li><a href="javascript:void(0);" data-week="21">SB</a></li>-->
                            <li><i class="fa fa-bar-chart" aria-hidden="true" id="chartExpand"></i></li>
                        </ul>
                    </div>
                </div>
                <div id="chartContainer" class="container">                        
                    <div class="row">
                        <div class="col-xs-12">
                            <div id="weeklyChart"></div>
                        </div>
                    </div>

                    <div class="row" id="switchChartButtons">
                        <div class="col-xs-6">
                            <button id="weeklyChartButton">Weekly Results</button>
                        </div>
                        <div class="col-xs-6">
                            <button id="overallChartButton">Overall Results</button>
                        </div>
                    </div>
                </div>
                <div id="resultsContainer">

                <div class="row" id="myResultsRow">
                    <div class="col-xs-3">
                        <span>Your Results</span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Straight Up:</span><span class="visible-xs">S/U:</span> <span id="myStraightUpResults"></span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Spread:</span><span class="visible-xs">ATS:</span> <span id="mySpreadResults"></span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Over/Under:</span><span class="visible-xs">O/U:</span> <span id="myTotalResults"></span>
                    </div>
                </div>
                <div class="row" id="crowdResultsRow">
                    <div class="col-xs-3">
                        <span>Crowd Results</span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Straight Up:</span><span class="visible-xs">S/U:</span> <span id="crowdStraightUpResults"></span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Spread:</span><span class="visible-xs">ATS:</span> <span id="crowdSpreadResults"></span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Over/Under:</span><span class="visible-xs">O/U:</span> <span id="crowdTotalResults"></span>
                    </div>
                </div>
            </div>



            <div class="row">
                <div class="col-xs-12">
        
                    <div id="games"></div>
                </div>
            </div>
        </div>
    </div>
</div>


  

</body>

</html>
