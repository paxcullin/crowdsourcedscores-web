<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/crowdsourcedscores-icon.png">
    <link rel="icon" type="image/png" href="assets/img/crowdsourcedscores-icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="description" content="Beating the sportsbooks with the Wisdom of the Crowd NFL Score Predictions">
    <meta name="keywords" content="football,crowdsourced,wisdom,wisdom of the crowd,sportsbook,spread,total,moneyline">
    <base href="https://crowdsourcedscores.com">

    <title>Crowd Wisdom Sports - Beating the Sportsbooks through Crowd Wisdom</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>

    <!--     Fonts and icons     -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

    <!-- CSS Files -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="assets/css/material-kit.css" rel="stylesheet"/>
    <link href="assets/css/hopscotch.min.css" rel="stylesheet"/>
    <link href="assets/css/cws.css" rel="stylesheet"/>


    <!--   Core JS Files   -->
    <script src="assets/js/jquery.min.js" type="text/javascript"></script>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        
        ga('create', 'UA-69748662-2', 'auto');
        ga('send', 'pageview');
    </script>


    <script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="assets/js/material.min.js"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="assets/js/nouislider.min.js" type="text/javascript"></script>
    <script src="assets/js/hopscotch.min.js" type="text/javascript"></script>

    <!--  Plugin for the Datepicker, full documentation here: http://www.eyecon.ro/bootstrap-datepicker/ -->
    <script src="assets/js/bootstrap-datepicker.js" type="text/javascript"></script>

    <!-- Control Center for Material Kit: activating the ripples, parallax effects, scripts from the example pages etc -->
    <script src="assets/js/material-kit.js" type="text/javascript"></script>

    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>-->



    <!-- Handlebars.js -->
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.js"></script>
        <!--Cognito Code-->
        <script type="text/javascript" src="assets/js/amazon-cognito-identity.js"></script>
        <!--End Cognito Code-->
        <!--JWT Decode Script-->
        <script src="assets/js/jwt-decode.min.js"></script>
        <script src="assets/js/userAuth.js"></script>
        <!--End JWT Decode Script-->

        <script type="text/javascript">

        Handlebars.registerHelper('grouped_each', function(every, context, options) {
            var out = "", subcontext = [], i;
            if (context && context.length > 0) {
                for (i = 0; i < context.length; i++) {
                    if (i > 0 && i % every === 0) {
                        out += options.fn(subcontext);
                        subcontext = [];
                    }
                    subcontext.push(context[i]);
                }
                out += options.fn(subcontext);
            }
            return out;
        });

        Handlebars.registerHelper('ifCond', function (v1, operator, v2, options) {
            
            switch (operator) {
                case '==':
                    return (v1 == v2) ? options.fn(this) : options.inverse(this);
                case '===':
                    return (v1 === v2) ? options.fn(this) : options.inverse(this);
                case '!=':
                    return (v1 != v2) ? options.fn(this) : options.inverse(this);
                case '!==':
                    return (v1 !== v2) ? options.fn(this) : options.inverse(this);
                case '<':
                    return (v1 < v2) ? options.fn(this) : options.inverse(this);
                case '<=':
                    return (v1 <= v2) ? options.fn(this) : options.inverse(this);
                case '>':
                    return (v1 > v2) ? options.fn(this) : options.inverse(this);
                case '>=':
                    return (v1 >= v2) ? options.fn(this) : options.inverse(this);
                case '&&':
                    return (v1 && v2) ? options.fn(this) : options.inverse(this);
                case '||':
                    return (v1 || v2) ? options.fn(this) : options.inverse(this);
                default:
                    return options.inverse(this);
            }
        });

        Handlebars.registerHelper('dateCheck', function (startDateTime, options) {

            var now = new Date();
            var nowDateTimeDate = Date.parse(now);
            var startDateTimeDate = Date.parse(startDateTime);
            var cutoff = startDateTimeDate - 300000;
            if (now < cutoff) {
                return options.fn(this);
            } else {
                return options.inverse(this);
            }
        });

        Handlebars.registerHelper('debug', function (the_string) {
            console.log(the_string, ": ", the_string);
        });
            </script>

    
    <script id="games-template" type="text/x-handlebars-template">
        <div class="container">
            <div class="row">
            {{#grouped_each 2 games}}
                {{#each this}}
                <div class="col-sm-8 col-md-4" id="container-{{{gameId}}}">
                    <div class="card prediction" style="margin-bottom:10px;min-width: 293px;" data-game-id="{{{gameId}}}"
                        data-game-week="{{{gameWeek}}}"
                        data-game-year="{{{year}}}"
                        data-home-code="{{{homeTeam.code}}}"
                        data-home-name="{{{homeTeam.fullName}}}" data-home-short="{{{homeTeam.shortName}}}"
                        data-away-code="{{{awayTeam.code}}}"
                        data-away-name="{{{awayTeam.fullName}}}" data-away-short="{{{awayTeam.shortName}}}"
                        {{#if prediction.awayTeam.score}} data-predicted="true" {{/if}}
                        style="display: inline-block;">
                        <div class="panel-group" id="{{{awayTeam.code}}}-{{{homeTeam.code}}}-accordion" role="tablist" aria-multiselectable="true">
                            <div class="panel panel-default">
                                <div class="panel-heading" role="tab" id="{{{awayTeam.code}}}-{{{homeTeam.code}}}-heading">
                                    <h4 class="panel-title">
                                        <a role="button" data-toggle="collapse" data-parent="#{{{awayTeam.code}}}-{{{homeTeam.code}}}-accordion" href="#{{{awayTeam.code}}}-{{{homeTeam.code}}}" aria-expanded="true" aria-controls="{{{awayTeam.code}}}-{{{homeTeam.code}}}">
                                            {{{awayTeam.fullName}}} vs. {{{homeTeam.fullName}}}
                                        </a>
                                    </h4>
                                </div>
                                <div id="{{{awayTeam.code}}}-{{{homeTeam.code}}}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="{{{awayTeam.code}}}-{{{homeTeam.code}}}-heading">
                                    <div class="panel-body">
                                        <div class="content">
                                            <div class="tab-content text-center">
                                                <div class="tab-pane active">
                                                    <div class="prediction-message" data-game-id="{{{gameId}}}"></div>
                                                    <div>
                                                        <div class="form-group">
                                                            <div class="gameHeader{{#if prediction}} gameHeaderPredicted{{/if}}{{#unless prediction}} gameHeaderNotPredicted{{/unless}}"><span style="float:left">{{startDateTime}}<br/>{{tvStation}}</span>{{#if results}}<span class="finalRow" style="float: right">FINAL</span>{{/if}}</div>
                                                            
                                                        </div>
                                                    </div>


                                                    <table class="table">
                                                        <thead>
                                                        <tr>
                                                            <th></th>
                                                            <th>Me</th>
                                                            <th class="compareHeader">{{#if comparePrediction}}{{comparePrediction.preferred_username}}{{/if}}{{#unless comparePrediction}}The Crowd{{/unless}}</th>
                                                            <th>Odds</th>
                                                            {{#if results}}<th>Actual</th>{{/if}}
                                                        </tr>
                                                        </thead>
                                                        <tbody>

                                                        <!-- Away Team Row -->
                                                        <tr class="predictionRow">
                                                            <td><i class="fa fa-plane" aria-hidden="true"></i>{{awayTeam.code}}</td>
                                                            <td class="away-team-prediction {{#if results}}{{#ifCond results.awayTeam.score '>' results.homeTeam.score}}{{#ifCond prediction.awayTeam.score '>' prediction.homeTeam.score}} alert alert-success{{/ifCond}}{{/ifCond}}{{/if}}" id="{{{awayTeam.code}}}-prediction">
                                                                {{#ifCond status '===' 'notStarted'}}
                                                                    <input type="number" min="0" max="50" class="form-control predictionInput" placeholder="##"
                                                                    value="{{prediction.awayTeam.score}}">
                                                                {{/ifCond}}
                                                                {{#ifCond status '!==' 'notStarted'}}
                                                                    {{#ifCond prediction.awayTeam.score '>' prediction.homeTeam.score}}<i class="fas fa-angle-double-right"></i>{{/ifCond}}{{prediction.awayTeam.score}}
                                                                    {{#if results}}
                                                                        {{#ifCond prediction.awayTeam.score '===' results.awayTeam.score}}
                                                                            <sup><i class="fas fa-bullseye"></i></sup>
                                                                        {{/ifCond}}
                                                                    {{/if}}
                                                                {{/ifCond}}
                                                            </td>
                                                            <td{{#if results}}
                                                                {{#unless comparePrediction}}
                                                                    {{#ifCond results.awayTeam.score '>' results.homeTeam.score}}{{#ifCond crowd.awayTeam.score '>' crowd.homeTeam.score}} class="crowdCorrect"{{/ifCond}}{{/ifCond}}
                                                                {{/unless}}
                                                                {{#if comparePrediction}}
                                                                    {{#ifCond results.awayTeam.score '>' results.homeTeam.score}}{{#ifCond comparePrediction.awayTeam.score '>' comparePrediction.homeTeam.score}} class="crowdCorrect"{{/ifCond}}{{/ifCond}}
                                                                {{/if}}
                                                            {{/if}}>
                                                                    {{#unless comparePrediction}}
                                                                    <span
                                                                        {{#unless prediction}}
                                                                            {{#unless results}}
                                                                                class="crowdHidden"
                                                                            {{/unless}}
                                                                        {{/unless}}>
                                                                        {{#ifCond crowd.awayTeam.score '>' crowd.homeTeam.score}}<i class="fas fa-angle-double-right"></i>{{/ifCond}}
                                                                        {{crowd.awayTeam.score}}
                                                                        {{#if results}}
                                                                            {{#ifCond crowd.awayTeam.score '===' results.awayTeam.score}}
                                                                                <sup><i class="fas fa-bullseye"></i></sup>
                                                                            {{/ifCond}}
                                                                        {{/if}}
                                                                    </span>
                                                                    {{/unless}}
                                                                    {{#if comparePrediction}}
                                                                        {{#ifCond comparePrediction.awayTeam.score '>' comparePrediction.homeTeam.score}}<i class="fas fa-angle-double-right"></i>{{/ifCond}}
                                                                        {{comparePrediction.awayTeam.score}}
                                                                        {{#if results}}
                                                                            {{#ifCond comparePrediction.awayTeam.score '===' results.awayTeam.score}}
                                                                                <sup><i class="fas fa-bullseye"></i></sup>
                                                                            {{/ifCond}}
                                                                        {{/if}}
                                                                    {{/if}}
                                                                {{#unless comparePrediction}}
                                                                    {{#unless prediction}}
                                                                        {{#unless results}}
                                                                            <span class="fa fa-lock crowdShown"></span>
                                                                        {{/unless}}
                                                                    {{/unless}}
                                                                {{/unless}}</td>
                                                            <td></td>
                                                            {{#if results}}<td>{{results.awayTeam.score}}</td>{{/if}}
                                                        </tr>
                                                        <!-- Home Team Row -->
                                                        <tr class="predictionRow">
                                                            <td><i class="fa fa-home" aria-hidden="true"></i> {{homeTeam.code}}</td>
                                                            <td class="home-team-prediction{{#if results}}{{#ifCond results.homeTeam.score '>' results.awayTeam.score}}{{#ifCond prediction.homeTeam.score '>' prediction.awayTeam.score}} alert alert-success{{/ifCond}}{{/ifCond}}{{/if}}" id="{{{homeTeam.code}}}-prediction">
                                                                {{#ifCond status '===' 'notStarted'}}
                                                                    <input type="number" min="0" max="50" class="form-control predictionInput" placeholder="##"
                                                                    value="{{prediction.homeTeam.score}}">
                                                                {{/ifCond}}
                                                                {{#ifCond status '!==' 'notStarted'}}
                                                                    {{#ifCond prediction.awayTeam.score '<' prediction.homeTeam.score}}<i class="fas fa-angle-double-right"></i>{{/ifCond}}
                                                                    {{prediction.homeTeam.score}}
                                                                    {{#if results}}
                                                                        {{#ifCond prediction.homeTeam.score '===' results.homeTeam.score}}
                                                                            <sup><i class="fas fa-bullseye"></i></sup>
                                                                        {{/ifCond}}
                                                                    {{/if}}
                                                                {{/ifCond}}
                                                            </td>
                                                            <td
                                                                {{#if results}}
                                                                        {{#ifCond results.homeTeam.score '>' results.awayTeam.score}}
                                                                            {{#unless comparePrediction}}
                                                                                {{#ifCond crowd.homeTeam.score '>' crowd.awayTeam.score}}
                                                                                class="crowdCorrect"
                                                                                {{/ifCond}}
                                                                            {{/unless}}
                                                                            {{#if comparePrediction}}
                                                                                {{#ifCond comparePrediction.homeTeam.score '>' comparePrediction.awayTeam.score}}
                                                                                class="crowdCorrect"
                                                                                {{/ifCond}}
                                                                            {{/if}}
                                                                        {{/ifCond}}
                                                                {{/if}}>
                                                                {{#unless comparePrediction}}
                                                                    <span
                                                                        {{#unless prediction}}
                                                                            {{#unless results}}
                                                                            class="crowdHidden"
                                                                            {{/unless}}
                                                                        {{/unless}}
                                                                    >{{#ifCond crowd.awayTeam.score '<' crowd.homeTeam.score}}<i class="fas fa-angle-double-right"></i>{{/ifCond}}{{crowd.homeTeam.score}}
                                                                    {{#if results}}
                                                                        {{#ifCond crowd.homeTeam.score '===' results.homeTeam.score}}
                                                                            <sup><i class="fas fa-bullseye"></i></sup>
                                                                        {{/ifCond}}
                                                                    {{/if}}
                                                                    </span>
                                                                    {{#unless prediction}}
                                                                        {{#unless results}}
                                                                            <span class="fa fa-lock crowdShown"></span>
                                                                        {{/unless}}
                                                                    {{/unless}}
                                                                {{/unless}}
                                                                {{#if comparePrediction}}
                                                                    {{#ifCond comparePrediction.awayTeam.score '<' comparePrediction.homeTeam.score}}<i class="fas fa-angle-double-right"></i>{{/ifCond}}{{comparePrediction.homeTeam.score}}
                                                                    {{#if results}}
                                                                        {{#ifCond comparePrediction.homeTeam.score '===' results.homeTeam.score}}
                                                                            <sup><i class="fas fa-bullseye"></i></sup>
                                                                        {{/ifCond}}
                                                                    {{/if}}
                                                                {{/if}}
                                                            </td>
                                                            <td>
                                                                    <span
                                                                        {{#unless prediction}}
                                                                            {{#unless results}}
                                                                            class="crowdHidden"
                                                                            {{/unless}}
                                                                        {{/unless}}
                                                                    >
                                                                    {{#ifCond odds.spread '>' 0}}+{{/ifCond}}{{odds.spread}}
                                                                    </span>
                                                            </td>
                                                            {{#if results}}<td>{{results.homeTeam.score}}</td>{{/if}}
                                                        </tr>
                                                        <!-- Total Row -->
                                                        <tr class="predictionRow">
                                                            <td>Total</td>
                                                            <td{{#if results}}
                                                                {{#ifCond prediction.total '>' odds.total}}
                                                                    {{#ifCond results.total '>' odds.total}}
                                                                        class="alert alert-success"
                                                                    {{/ifCond}}
                                                                {{/ifCond}}
                                                                {{#ifCond odds.total '>' prediction.total}}
                                                                    {{#ifCond odds.total '>' results.total}}
                                                                    class="alert alert-success"
                                                                    {{/ifCond}}
                                                                {{/ifCond}}
                                                            {{/if}} id="{{{awayTeam.code}}}{{{homeTeam.code}}}-total-prediction">
                                                            {{prediction.total}}
                                                            {{#if results}}
                                                                {{#ifCond prediction.total '===' results.total}}
                                                                    <sup><i class="fas fa-bullseye"></i></sup>
                                                                {{/ifCond}}
                                                            {{/if}}
                                                            <span style="font-size: 0.8em; font-weight: bold">{{#ifCond prediction.total '>' odds.total}}<br>(o{{odds.total}}){{/ifCond}}{{#ifCond prediction.total '<' odds.total}}<br>(u{{odds.total}}){{/ifCond}}</span>
                                                            </td>
                                                            <td
                                                                {{#if results}}
                                                                    {{#unless comparePrediction}}
                                                                        {{#ifCond crowd.total '>' odds.total}}
                                                                            {{#ifCond results.total '>' odds.total}} class="crowdCorrect"
                                                                            {{/ifCond}}
                                                                        {{/ifCond}}
                                                                        {{#ifCond odds.total '>' crowd.total}}
                                                                            {{#ifCond odds.total '>' results.total}} class="crowdCorrect"
                                                                            {{/ifCond}}
                                                                        {{/ifCond}}
                                                                    {{/unless}}
                                                                    {{#if comparePrediction}}
                                                                        {{#ifCond comparePrediction.total '>' odds.total}}
                                                                            {{#ifCond results.total '>' odds.total}} class="crowdCorrect"
                                                                            {{/ifCond}}
                                                                        {{/ifCond}}
                                                                        {{#ifCond odds.total '>' comparePrediction.total}}
                                                                            {{#ifCond odds.total '>' results.total}} class="crowdCorrect"
                                                                            {{/ifCond}}
                                                                        {{/ifCond}}
                                                                    {{/if}}
                                                                {{/if}}>
                                                                        {{#unless comparePrediction}}
                                                                            <span{{#unless prediction}}
                                                                                {{#unless results}} class="crowdHidden"
                                                                                {{/unless}}
                                                                            {{/unless}}>
                                                                            {{crowd.total}}
                                                                            <span style="font-size: 0.8em; font-weight: bold">
                                                                                {{#if results}}
                                                                                    {{#ifCond crowd.total '===' results.total}}
                                                                                        <sup><i class="fas fa-bullseye"></i></sup>
                                                                                    {{/ifCond}}
                                                                                {{/if}}
                                                                                {{#ifCond crowd.total '>' odds.total}}<br>(o{{odds.total}}){{/ifCond}}
                                                                                {{#ifCond crowd.total '<' odds.total}}<br>(u{{odds.total}}){{/ifCond}}</span>

                                                                            </span>
                                                                            {{#unless prediction}}
                                                                                {{#unless results}}
                                                                                    <span class="fa fa-lock crowdShown"></span>
                                                                                {{/unless}}
                                                                            {{/unless}}
                                                                        {{/unless}}
                                                                        {{#if comparePrediction}}
                                                                            {{comparePrediction.total}}
                                                                            {{#if results}}
                                                                                {{#ifCond comparePrediction.total '===' results.total}}
                                                                                    <sup><i class="fas fa-bullseye"></i></sup>
                                                                                {{/ifCond}}
                                                                            {{/if}}
                                                                        {{/if}}
                                                            </td>
                                                            <td>
                                                                <span
                                                                    {{#unless prediction}}
                                                                        {{#unless results}}
                                                                        class="crowdHidden"
                                                                        {{/unless}}
                                                                    {{/unless}}>{{odds.total}}</span></td>
                                                            {{#if results}}<td>{{results.total}}</td>{{/if}}
                                                        </tr>
                                                        <!-- Spread Row -->
                                                        <tr class="predictionRow">
                                                            <td>Spread</td>
                                                            <td
                                                                {{#if results}}
                                                                    {{#ifCond prediction.results.spread.correct '===' 1}} class="alert alert-success"
                                                                    {{/ifCond}}
                                                                {{/if}} id="{{{awayTeam.code}}}{{{homeTeam.code}}}-spread-prediction">
                                                                    {{#ifCond prediction.spread '>' 0}}+{{/ifCond}}{{prediction.spread}}
                                                                    {{#if results}}
                                                                        {{#ifCond prediction.spread '===' results.spread}}
                                                                            <sup><i class="fas fa-bullseye"></i></sup>
                                                                        {{/ifCond}}
                                                                    {{/if}}
                                                                    <!-- Show the side picked against the spread -->
                                                                    <span style="font-size: 0.8em; font-weight: bold">
                                                                        {{#ifCond prediction.spread '>' odds.spread}}
                                                                            <br>({{awayTeam.code}}
                                                                                <!-- Format the odds -->
                                                                                {{#ifCond odds.spread '<' 0}}{{#math odds.spread '*' -1}}{{/math}}{{/ifCond}}
                                                                                {{#ifCond odds.spread '>' 0}}+{{odds.spread}}{{/ifCond}}
                                                                                {{#ifCond odds.spread '===' 0}}EV{{/ifCond}})
                                                                        {{/ifCond}}
                                                                        {{#ifCond prediction.spread '<' odds.spread}}
                                                                            <br>({{homeTeam.code}}
                                                                                {{#ifCond odds.spread '<' 0}}{{#math odds.spread '*' -1}}{{/math}}{{/ifCond}}
                                                                                {{#ifCond odds.spread '>' 0}}+{{odds.spread}}{{/ifCond}}
                                                                                {{#ifCond odds.spread '===' 0}}EV{{/ifCond}})
                                                                        {{/ifCond}}
                                                                    </span>
                                                            </td>
                                                            <td
                                                                {{#if results}}
                                                                    {{#unless comparePrediction}}
                                                                        {{#ifCond crowd.spread '>' odds.spread}}
                                                                            {{#ifCond results.spread '>' odds.spread}} class="crowdCorrect"
                                                                            {{/ifCond}}
                                                                        {{/ifCond}}
                                                                        {{#ifCond odds.spread '>' crowd.spread}}
                                                                            {{#ifCond odds.spread '>' results.spread}} class="crowdCorrect"
                                                                            {{/ifCond}}
                                                                        {{/ifCond}}
                                                                    {{/unless}}
                                                                    {{#if comparePrediction}}
                                                                        {{#ifCond comparePrediction.spread '>' odds.spread}}
                                                                            {{#ifCond results.spread '>' odds.spread}} class="crowdCorrect"
                                                                            {{/ifCond}}
                                                                        {{/ifCond}}
                                                                        {{#ifCond odds.spread '>' comparePrediction.spread}}
                                                                            {{#ifCond odds.spread '>' results.spread}} class="crowdCorrect"
                                                                            {{/ifCond}}
                                                                        {{/ifCond}}
                                                                    {{/if}}
                                                                {{/if}}>
                                                                {{#unless comparePrediction}}
                                                                    <span
                                                                        {{#unless prediction}}
                                                                            {{#unless results}}
                                                                            class="crowdHidden"
                                                                            {{/unless}}
                                                                        {{/unless}}>
                                                                            {{#ifCond crowd.spread '>' 0}}+{{/ifCond}}
                                                                            {{crowd.spread}}
                                                                            {{#if results}}
                                                                                {{#ifCond crowd.spread '===' results.spread}}
                                                                                    <sup><i class="fas fa-bullseye"></i></sup>
                                                                                {{/ifCond}}
                                                                            {{/if}}
                                                                            <span style="font-size: 0.8em; font-weight: bold">
                                                                                {{#ifCond crowd.spread '>' odds.spread}}
                                                                                    <br>({{awayTeam.code}} 
                                                                                    {{#ifCond odds.spread '<' 0}}{{#math odds.spread '*' -1}}{{/math}}{{/ifCond}}
                                                                                    {{#ifCond odds.spread '>' 0}}+{{odds.spread}}{{/ifCond}}
                                                                                    {{#ifCond odds.spread '===' 0}}EV{{odds.spread}}{{/ifCond}})
                                                                                {{/ifCond}}
                                                                                {{#ifCond crowd.spread '<' odds.spread}}
                                                                                    <br>({{homeTeam.code}}
                                                                                    {{#ifCond odds.spread '<' 0}}{{#math odds.spread '*' -1}}{{/math}}{{/ifCond}}
                                                                                    {{#ifCond odds.spread '>' 0}}+{{odds.spread}}{{/ifCond}}
                                                                                    {{#ifCond odds.spread '===' 0}}+{{odds.spread}}{{/ifCond}})
                                                                                {{/ifCond}}
                                                                            </span>

                                                                    </span>
                                                                    {{#unless prediction}}
                                                                        {{#unless results}}<span class="fa fa-lock crowdShown"></span>
                                                                        {{/unless}}
                                                                    {{/unless}}
                                                                {{/unless}}
                                                                {{#if comparePrediction}}
                                                                    {{#ifCond comparePrediction.spread '>' 0}}+{{/ifCond}}
                                                                    {{comparePrediction.spread}}
                                                                    {{#if results}}
                                                                        {{#ifCond comparePrediction.spread '===' results.spread}}
                                                                            <sup><i class="fas fa-bullseye"></i></sup>
                                                                        {{/ifCond}}
                                                                    {{/if}}
                                                                    <span style="font-size: 0.8em; font-weight: bold">
                                                                        {{#ifCond comparePrediction.spread '>' odds.spread}}
                                                                            <br>({{awayTeam.code}} {{#ifCond odds.spread '>' 0}}
                                                                                                    -{{/ifCond}}{{odds.spread}})
                                                                        {{/ifCond}}
                                                                        {{#ifCond comparePrediction.spread '<' odds.spread}}
                                                                            <br>({{homeTeam.code}} {{#ifCond odds.spread '>' 0}}+{{/ifCond}}{{odds.spread}})
                                                                        {{/ifCond}}
                                                                    </span>
                                                                {{/if}}
                                                            </td>
                                                            <td>
                                                                    <span
                                                                        {{#unless prediction}}
                                                                            {{#unless results}}
                                                                            class="crowdHidden"
                                                                            {{/unless}}
                                                                        {{/unless}}>
                                                                    {{#ifCond odds.spread '!=' 0}}{{#ifCond odds.spread '>' 0}}+{{/ifCond}}{{odds.spread}}{{/ifCond}}
                                                                    {{#ifCond odds.spread '===' 0}}Even{{/ifCond}}</span></td>
                                                            {{#if results}}<td>{{results.spread}}</td>{{/if}}
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                    
                                                    <div>
                                                    {{#unless results}}
                                                        {{#if userAuthenticated}}
                                                            {{#dateCheck startDateTime}}
                                                                <button class="prediction-btn btn btn-info">Predict</button>
                                                            {{/dateCheck}}
                                                        {{/if}}
                                                        {{#unless userAuthenticated}}
                                                            {{#dateCheck startDateTime}}
                                                                <button type="button" class="btn btn-info" onclick="ga('send','event','login','loginClicked');window.location=('https://crowdsourcedscores.auth.us-west-2.amazoncognito.com/login?response_type=code&client_id=2n15lhk845sucm0k4fejjqcbev&redirect_uri=https://crowdsourcedscores.com')">Log in to Predict</button>
                                                            {{/dateCheck}}
                                                        {{/unless}}
                                                    {{/unless}}
                                                        {{#if prediction.predictionScore}}
                                                            <div class="predictionScore">Prediction Score: {{prediction.predictionScore}} <i class="fas fa-info-circle" data-toggle="modal" data-target="#predictionScoreModal"></i></div>
                                                        {{/if}}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {{/each}}
                <div class="clearfix"></div>
            {{/grouped_each}}
        </div>
        <div id="lastRow" class="row"></div>
        </div>
    </script>
    <script src="https://www.google.com/jsapi" type="text/javascript"></script>

    <script>
        var view;
            function buildChart(leaderboardData) {
                if (!view) { view = "weekly";}
                var weeklyResults = {results: leaderboardData.weekly};
                var overallResults = {results: leaderboardData.overall};
                if (!leaderboardData || weeklyResults.results.length < 2 || overallResults.results.length < 2) { return }
                
                var data = google.visualization.arrayToDataTable(weeklyResults.results);
                if (view === "overall") {
                    data = google.visualization.arrayToDataTable(overallResults.results);
                }
                var options = {
                    weekly: {
                        title: 'Crowd Week-by-Week Performance',
                        hAxis: {title: 'Week',  titleTextStyle: {color: '#333'}},
                        vAxis: {minValue: 0,
                                maxValue:12},
                        seriesType: 'bars',
                        series: {3: {type: 'scatter'}},
                        colors: ['#B42135', '#3A3B6C', '#A3A3A4','#000'],
                        legend: {position: 'bottom'},
                        explorer: {
                                axis: 'horizontal',
                                keepInBounds: true,
                                maxZoomIn: 4.0
                        }
                    },
                    overall: {
                        title: 'Crowd Week-by-Week Percent Correct',
                        hAxis: {title: 'Week',  titleTextStyle: {color: '#333'}},
                        vAxis: {minValue: 0,
                                maxValue:100},
                        seriesType: 'line',
                        colors: ['#B42135', '#3A3B6C', '#A3A3A4'],
                        legend: {position: 'bottom'},
                        explorer: {
                                axis: 'horizontal',
                                keepInBounds: true,
                                maxZoomIn: 4.0
                        }
                    }
                };

                var chart = new google.visualization.ComboChart(document.getElementById('weeklyChart'));
                chart.draw(data, options[view]);
            }

        var getGameWeek = function (callback) {
            useToken(function(token) {
                console.log("getGameWeek token: ", token);
                var getGameWeekURL = "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/week";
                var getGameWeekURLOptions = {
                    method: "GET",
                    headers: {
                        'Authorization': token
                    }
                }
                if (token === false) {
                    getGameWeekURL = "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/week/anon"
                    getGameWeekURLOptions = {
                        method: "GET"
                    }
                }
                get(getGameWeekURL, getGameWeekURLOptions)
                .then(function(response) {
                    return response.json();
                })
                .then(function (data) {
                    //data.year = 2017;
                    return callback(data);
                })
                .catch(function(err) {
                    console.log("Error: ", err);
                    return;
                });
            });
        };

        var formatGameTimes = function (games) {
            for (var i = 0; i < games.length; i++) {
                var gameDate = new Date(games[i].startDateTime);
                var options = { weekday: 'short', month: 'short', day: 'numeric', year: '2-digit', hour: 'numeric', minute: 'numeric', timeZoneName: 'short' };
                games[i].startDateTime = gameDate.toLocaleString('en-US', options);
            }
            return games;
        }


        // setting user weekly results
        var getWeeklyResults = function(gamesData) {
            var myStraightUpResults = 0;
            var mySpreadResults = 0;
            var myTotalResults = 0;
            var myPredictionScore = 0;

            console.log("data: ", gamesData)
            if (gamesData && gamesData.length > 0) {
                for (i = 0; i < gamesData.length; i++) {
                    if (gamesData[i].prediction && gamesData[i].prediction.results) {
                        $("#resultsContainer").css("display","block");
                        if (gamesData[i].prediction.results.winner.correct) {myStraightUpResults += gamesData[i].prediction.results.winner.correct;}
                        if (gamesData[i].prediction.results.spread.correct) {mySpreadResults += gamesData[i].prediction.results.spread.correct;}
                        if (gamesData[i].prediction.results.total.correct) {myTotalResults += gamesData[i].prediction.results.total.correct;}
                        if (gamesData[i].prediction.predictionScore) {myPredictionScore += gamesData[i].prediction.predictionScore;}
                    }
                }
                console.log("myStraightUpResults: ", myStraightUpResults);
                $("#myStraightUpResults").text(myStraightUpResults);
                $("#mySpreadResults").text(mySpreadResults);
                $("#myTotalResults").text(myTotalResults);
                $("#myPredictionScore").text(myPredictionScore);
            }
        }

        var getWeeklyCrowdResults = function(crowdData) {
            var crowdStraightUpResults = 0;
            var crowdSpreadResults = 0;
            var crowdTotalResults = 0;
            var crowdPredictionScore = 0;
            if (crowdData && crowdData.length > 0) {
                for (i = 0; i < crowdData.length; i++) {
                    if (crowdData[i].crowd && crowdData[i].crowd.results) {
                        $("#resultsContainer").css("display","block");
                        if (crowdData[i].crowd.results.winner && crowdData[i].crowd.results.winner.correct) {crowdStraightUpResults += crowdData[i].crowd.results.winner.correct;}
                        if (crowdData[i].crowd.results.spread && crowdData[i].crowd.results.spread.correct) {crowdSpreadResults += crowdData[i].crowd.results.spread.correct;}
                        if (crowdData[i].crowd.results.total && crowdData[i].crowd.results.total.correct) {crowdTotalResults += crowdData[i].crowd.results.total.correct;}
                        if (crowdData[i].crowd.results.predictionScore) {crowdPredictionScore += crowdData[i].crowd.results.predictionScore;}
                    }
                }
                $("#crowdStraightUpResults").text(crowdStraightUpResults);
                $("#crowdSpreadResults").text(crowdSpreadResults);
                $("#crowdTotalResults").text(crowdTotalResults);
                $("#crowdPredictionScore").text(crowdPredictionScore);
            }
        }

        var setGameWeek = function (gameWeekData) {

            useToken(function(token) {
                var compareQuery = "";
                if (getUrlParameter('compareUsername')) {
                    compareQuery = "?compareUsername=" + getUrlParameter('compareUsername');
                }
                var setGameWeekURL = "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/" + gameWeekData.year + "/" + gameWeekData.week + "/games" + compareQuery;
                var setGameWeekGetOptions = 
                    {     
                        method: "GET",
                        headers: {
                                'Authorization': token
                        }
                    }
                    // creating anonymous API call for games
                if (token === false) {
                    setGameWeekURL = "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/" + gameWeekData.year + "/" + gameWeekData.week + "/games/anon";
                    setGameWeekGetOptions = {     
                        method: "GET"
                    }
                }
                get(setGameWeekURL, setGameWeekGetOptions)
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                    userInformation.predictionsSubmitted = data.predictionsSubmitted;
                    var totalGames = data.games.length;
                    updateProgressBar(userInformation.predictionsSubmitted, totalGames);
                        $("#games-loading-icon").css("display","none")

                        formatGameTimes(data.games);
                        var games = {games: data.games};
                        //console.log("games: ", games)
                        var template = $('#games-template').html();
                        var templateScript = Handlebars.compile(template);
                        var html = templateScript(games);
                        $('#games').html(html);

      
                        //drawChart2(year, week);
                        $('.prediction-btn').on('click', function (e) {
                            e.preventDefault();
                            $(this).text('Saving...');
                            var newPrediction = true;
                            var $prediction = $(this).parents('.prediction');
                            var prediction = {
                                gameId: parseInt($prediction.attr('data-game-id')),
                                gameWeek: parseInt($prediction.attr('data-game-week')),
                                year: parseInt($prediction.attr('data-game-year')),
                                awayTeam: {
                                    code: $prediction.attr('data-away-code'),
                                    fullName: $prediction.attr('data-away-name'),
                                    shortName: $prediction.attr('data-away-short')
                                },
                                homeTeam: {
                                    code: $prediction.attr('data-home-code'),
                                    fullName: $prediction.attr('data-home-name'),
                                    shortName: $prediction.attr('data-home-short')
                                }
                            };
                            var accordionId = $(this).parents("#" + prediction.awayTeam.code + "-" + prediction.homeTeam.code + "-accordion");
                            console.log("accordionId: ", accordionId)
                            if ($prediction.attr('data-predicted') === true || $prediction.attr('data-predicted') === "true") {
                                prediction.update = true;
                            }
                            var btn = $(this);
                            var predictionElm = $('#games').find("[data-game-id='" + prediction.gameId + "']");
                            var messageElm = predictionElm.find(".prediction-message");
                            

                            var awayTeamPrediction = $prediction.find('.away-team-prediction input').val();
                            var homeTeamPrediction = $prediction.find('.home-team-prediction input').val();

                            var away = $prediction.attr('data-away-team');
                            var home = $prediction.attr('data-home-team');

                            var awayCode = $prediction.attr('data-away-code');
                            var homeCode = $prediction.attr('data-home-code');

                            prediction.awayTeam.score = parseInt(awayTeamPrediction);
                            prediction.homeTeam.score = parseInt(homeTeamPrediction);

                            //submitPrediction(prediction, $(this));
                            useToken(function(token){
                                //console.log("submitPrediction Token: ", token)
                                apiClient.predictionsPost({},JSON.stringify(prediction),{headers: {Authorization: token}})
                                .then(function(response) {
                                    //console.log("response message:", response)
                                    switch(response.status) {
                                        case 200:
                                            //console.log("200: ", response);
                                            btn.text('Update');
                                            ga('send','event','prediction','submitted',prediction.gameId);

                                            var messageHtml = statusMessage('success', response.data.message);
                                            messageElm.html(messageHtml)
                                            $prediction.find('.gameHeaderPredicted').html("<i class=\"fa fa-check-circle\"></i>")
                                            //console.log("response.data.updated: ", response.data.updated)
                                            if (response.data.predictionsSubmitted > -1) updateProgressBar(response.data.predictionsSubmitted, totalGames);
                                            //moveBoxes(prediction.gameId);

                                            //$("#" + awayCode + "-" + homeCode).toggleClass("active");
                                            $prediction.find('.panel-collapse.in').collapse('hide');
                                            return;
                                        case 400:
                                            var errorObj = response.responseText;
                                            console.log("400: ", errorObj);
                                            btn.text('Predict');
                                            var messageHtml = statusMessage('danger', errorObj.message);
                                            messageElm.html(messageHtml);
                                            return;
                                        case 500:
                                            var errorObj = response.responseText;
                                            console.log("500: ", errorObj);
                                            btn.text('Predict');
                                            var messageHtml = statusMessage('danger', errorObj.message);
                                            messageElm.html(messageHtml);
                                            return;
                                    }
                                    return true;
                                })
                                .catch(function(reject) {
                                    console.log("reject message: ", reject)
                                })
                            })
                            // Update prediction table cell
                            //$('#' + awayCode + '-prediction').text(prediction.awayTeam.score);
                            //$('#' + homeCode + '-prediction').text(prediction.homeTeam.score);
                            $('#' + awayCode + homeCode + '-total-prediction').text(prediction.awayTeam.score + prediction.homeTeam.score);
                            $('#' + awayCode + homeCode + '-spread-prediction').text(prediction.awayTeam.score - prediction.homeTeam.score);
                            //show odds and crowd info
                            $prediction.find('.crowdHidden').removeClass('crowdHidden');
                            $prediction.find('.crowdShown').addClass('crowdHidden').removeClass('crowdShown');
                        });
                        return data;
                    })
                    .catch(function (jqXHR, textStatus, errorThrown) {
                        console.log("Error getting games: ", jqXHR, textStatus, errorThrown);
                        if (jqXHR.status == 0) {
                            lock.show();
                        }
                    })
                    .then(function (data) {
                        // Start the tour!
                        // Check for users who have finished/closed the tour
                        var userState = hopscotch.getState();
                        if (cognitoUser) {
                            // Define the tour!
                            var userTourState = localStorage.getItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.finishedTour');
                            var tour = {
                                id: "hello-hopscotch",
                                steps: [
                                    {
                                        title: "Thanks for joining the crowd!",
                                        content: "Let's walk you through how you can add your expertise to the crowd wisdom.",
                                        target: document.querySelector('#games'),
                                        placement: "top",
                                        onNext: function() {
                                            ga('send','event','authenticated-tour','step',hopscotch.getCurrStepNum());
                                        }
                                    },
                                    {
                                        title: "Worried you're not an expert?",
                                        content: "Don't fret! You know just as much as anyone about what's going to happen, and the experts are wrong all the time. So just have fun! It's easy. We'll show you.",
                                        target: document.getElementsByClassName('card')[0],
                                        placement: "top",
                                        onNext: function() {
                                            ga('send','event','authenticated-tour','step',hopscotch.getCurrStepNum());
                                        }
                                    },
                                {
                                        title: "Away Team Score",
                                        content: "How many points do you think the <b>away team</b> will score?",
                                        target: document.getElementsByClassName('predictionInput')[0],
                                        placement: "top",
                                        onNext: function() {
                                            ga('send','event','authenticated-tour','step',hopscotch.getCurrStepNum());
                                        }
                                },
                                {
                                    title: "Home Team Score",
                                    content: "How many points do you think the <b>home team</b> will score?",
                                    target: document.getElementsByClassName('predictionInput')[1],
                                    placement: "top",
                                        onNext: function() {
                                            ga('send','event','authenticated-tour','step',hopscotch.getCurrStepNum());
                                        }
                                },
                                {
                                    title: "Predict!",
                                    content: "That's it! Now click the predict button.",
                                    target: document.getElementsByClassName('prediction-btn')[0],
                                    placement: "top",
                                        onNext: function() {
                                            ga('send','event','authenticated-tour','step',hopscotch.getCurrStepNum());
                                        }
                                },
                                {
                                    title: "Nice! Keep It Up!",
                                    content: "You'll be able to see how many games are still waiting for your expertise in the progress bar.",
                                    target: document.querySelector('#progress-bar'),
                                    placement: "top",
                                        onNext: function() {
                                            ga('send','event','authenticated-tour','step',hopscotch.getCurrStepNum());
                                        }
                                },
                                {
                                    title: "Lots of ways to Compete",
                                    content: "<p>By making predictions, you are automatically competing against every other user in our Crowd.</p><p>But you can also create your own Mini-Crowd (coworkers, friends, enemies) and compete for bragging rights.</p><p>Each Mini-Crowd generates its own crowd wisdom, and you can watch how your Mini-Crowd's crowd wisdom performs against the others.</p><p>So you can always contribute to the crowd wisdom and help your Mini-Crowd compete!",
                                    target: document.querySelector('#allGroupsHeader'),
                                    placement: "top",
                                    onNext: function() {
                                        console.log("setTourState")
                                        localStorage.setItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.' + cognitoUser.username + '.finishedTour', true);
                                        ga('send','event','authenticated-tour','step',hopscotch.getCurrStepNum())
                                    }
                                }
                                ],
                                onEnd: function() {
                                    localStorage.setItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.' + cognitoUser.username + '.finishedTour', true);
                                    updateUserAttributes([{Name: "custom:completedTour", Value: "1"}])
                                    ga('send','event','tour','step','ended');
                                }
                            };
                            var localTourState = localStorage.getItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.' + cognitoUser.username + '.finishedTour');
                            if (parseInt(userInformation.attributes["custom:completedTour"]) === 1) {
                                console.log("user has taken the tour");
                            } else {
                                hopscotch.startTour(tour);
                            }
                        } else {

                            var userTourState = localStorage.getItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.finishedTour');
                            var anonymousTour = {
                                id: "intro-tour",
                                steps: [
                                    {
                                        title: "Welcome!",
                                        content: "New here? Want to know what this is about? Take the Tour!",
                                        target: document.querySelector('#games'),
                                        placement: "top",
                                        showPrevButton: true,
                                        i18n: {
                                            nextBtn: "Start the Tour!",
                                            prevBtn: "No thanks!"
                                        },
                                        onPrev: function() {
                                            localStorage.setItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.' + cognitoUser.username + '.finishedTour', true)
                                        },
                                        onNext: function() {
                                            ga('send','event','anonymous-tour','step',hopscotch.getCurrStepNum())
                                        }
                                    },
                                    {
                                    title: "Beyond the Coin Flip",
                                    content: "We wanted to create a game that gives you a chance to use your expertise.<br>Instead of a 50/50 chance at picking the winner or the side, you predict the score for each team in (probably) the same amount of time.",
                                    target: document.getElementsByClassName('card')[0],
                                    placement: "top",
                                        onNext: function() {
                                            ga('send','event','anonymous-tour','step',hopscotch.getCurrStepNum())
                                        }
                                    },
                                {
                                    title: "Prediction Scoring",
                                    content: "<p>Instead of an all-or-nothing result that can turn be decided on the last play, you earn points for each part of your score: winner (2 points), spread (2 points), and total (2 points). You also get a +1 bonus for an on-the-money (i.e. exact) prediction.</p><p>Each prediction can earn up to 10 points; a 4-point score is good, 6 is great, 7 is incredible, and 10 means you should take your act to Vegas.</p>",
                                    target: document.getElementsByClassName('predictionInput')[0],
                                    placement: "top",
                                        onNext: function() {
                                            ga('send','event','anonymous-tour','step',hopscotch.getCurrStepNum())
                                        }
                                },
                                {
                                    title: "Compete against the entire Crowd. Compete against just your Crowd.",
                                    content: "<p>By participating, you are already competing against everyone else to see who has the best prediction skills.</p><p>You can also create or join a crowd to earn bragging rights among your friends, enemies, or coworkers.</p>",
                                    target: document.getElementById('competitionDiv'),
                                    placement: "top",
                                        onNext: function() {
                                            ga('send','event','anonymous-tour','step',hopscotch.getCurrStepNum())
                                        }
                                },
                                {
                                    title: "Crowd vs. Crowd",
                                    content: "Last thing: each crowd will have its own wisdom, so each crowd can compete against every other crowd to see who has the best crowd wisdom.",
                                    target: document.getElementById('crowds-tab'),
                                    placement: "top",
                                        onNext: function() {
                                            ga('send','event','anonymous-tour','step',hopscotch.getCurrStepNum())
                                        }
                                },
                                {
                                    title: "Ready to Play?",
                                    content: "Thanks for taking the tour! If you're ready to play, sign up and get your weekly predictions in!",
                                    target: document.querySelector('#loginButtons'),
                                    placement: "right",
                                        onNext: function() {
                                            ga('send','event','anonymous-tour','step',hopscotch.getCurrStepNum())
                                        }
                                }
                                ],
                                onEnd: function() {
                                    localStorage.setItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.finishedTour', true);
                                }
                            };
                            var localTourState = localStorage.getItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.finishedTour');
                            if (localTourState === true) {
                                console.log("logged out user has taken the tour");
                            } else {
                                hopscotch.startTour(anonymousTour);
                            }
                        }
                        getWeeklyResults(data.games);
                        return data;
                    })
                    .then(function (data) {
                        getWeeklyCrowdResults(data.games)
                        return data;
                    })
                    .then(function(data) {
                        if (data && data.games && data.games.length > 0) {
                            drawChart2(gameWeekData.year, gameWeekData.week, "weekly");
                        }
                    });
            });
        };

        //jQuery for animating boxes after they're predicted

            function moveBoxes(gameId) {
                $("#container-" + gameId).animate({opacity: '0.1'}, 1500, function() {
                    var predictedGame = $("#container-" + gameId).detach();
                    $("#lastRow").append(predictedGame);
                });
                $("#container-" + gameId).animate({opacity: '1.0'}, 1500);
            }

        var submitPrediction = function (prediction, btn) {
            useToken(function(token) {
                //console.log("prediction: ", JSON.stringify(prediction))
                var setSubmitPredictionsOptions = 
                        {     
                            method: "POST",
                            headers: {
                                    'Authorization': token
                            },
                            body: prediction
                        }
                    get("https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/predictions",setSubmitPredictionsOptions)
                    .then(function(response) {
                        switch(response.status) {
                            case "200":
                                console.log("200: ", response);
                                ga('send','event','prediction','submitted',prediction.gameId);
                                btn.text('Predict');
                                var messageHtml = statusMessage('success', response.message);
                                messageElm.html(messageHtml)
                                updateProgressBar(userInformation.predictionsSubmitted, totalGames)
                                moveBoxes(prediction.gameId);
                            case "400":
                                var errorObj = response.responseText;
                                console.log("400: ", errorObj);
                                btn.text('Predict');
                                var messageHtml = statusMessage('danger', errorObj.message);
                                messageElm.html(messageHtml);
                            case "500":
                                var errorObj = response.responseText;
                                console.log("500: ", errorObj);
                                btn.text('Predict');
                                var messageHtml = statusMessage('danger', errorObj.message);
                                messageElm.html(messageHtml);

                        }
                    });
                var predictionElm = $('#games').find("[data-game-id='" + prediction.gameId + "']");
                var messageElm = predictionElm.find(".prediction-message");
                // ,
                //             statusCode: {
                //             }
            });
        };

        var statusMessage = function (type, message) {
            var icon = type === 'success' ? 'check' : 'error_outline';
            var head = type === 'success' ? 'Success' : 'Error';
            return '<div class="alert alert-' + type + '" style="padding:5px;"> \
                                <div class="container-fluid"> \
                                <div class="alert-icon"> \
                                <i class="material-icons">' + icon + '</i> \
                                </div> \
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close"> \
                                <span aria-hidden="true"><i class="material-icons">clear</i></span> \
                                </button> \
                                <b>' + head + '</b> ' + message + '\
                        </div> \
                        </div>';
        };


        var gameWeekData = {};
        $(document).ready(function () {

            if (cognitoUser) {
                showLogoutButton();
            } else {
                showLoginButton();
            }



            $('#weekSelector li').on('click', 'a', function () {
                gameWeekData.year = parseInt($('#dropdown span').text());
                if (!gameWeekData.year) gameWeekData.year = 2018;
                gameWeekData.week = parseInt($(this).attr('data-week'));
                $("#games-loading-icon").css("display","block")
                $('#weekSelector li').removeClass('active');
                $('#resultsContainer').css('display','none');
                $(this).parent('li').addClass('active');
                setGameWeek(gameWeekData);
                //deferredLeaderboardRequest2(gameWeekData.year, gameWeekData.week, id_token, buildChart);
            });

            console.log("gameWeekData.week: ", gameWeekData.week);

            setTimeout(function () {
                getGameWeek(function (data) {
                    if (data) {
                        week = data.week;
                        year = parseInt($('#dropdown span').text);
                        if (data.year) {
                            year = data.year;
                        }
                        var $selectorElm = $('*[data-week="' + week + '"]');
                        $selectorElm.parent('li').addClass('active');
                        $("#weeklyChartButton").attr({"year":year,"week": week});
                        $("#overallChartButton").attr({"year":year,"week": week});
                        setGameWeek(data);
                        //deferredLeaderboardRequest2(year, week, id_token, buildChart);
                    }
                });
            }, 1000);

            $('#weeklyChartButton').click(function () {
                view = "weekly";
                ga('send','event','chartSwitch','switched',view);
                drawChart2($(this).attr("year"), $(this).attr("week"), "weekly");
            });
            $('#overallChartButton').click(function () {
                view = "overall";
                ga('send','event','chartSwitch','switched',view);
                drawChart2($(this).attr("year"), $(this).attr("week"), "overall")
            });
            $('#newsletter-signup-div').click(function () {
                ga('send','event','newsletter','viewed');

                $header = $(this);
                //getting the next element
                $content = $("#newsletter-form-div");
                //open up the content needed - toggle the slide- if visible, slide up, if not slidedown.
                $content.slideToggle(500, function () {
                    //execute this after slideToggle is done
                    //change text of header based on visibility of content div
                    $header.text(function () {
                        //change text based on condition
                        //return $content.is(":visible") ? "" : "";
                    });
                });
            });

            $('#mc-embedded-subscribe').click(function () {
                ga('send','event','newsletter','subscribed');

                $header = $(this);
                //getting the next element
                $content = $("#newsletter-form-div");
                //open up the content needed - toggle the slide- if visible, slide up, if not slidedown.
                $content.slideToggle(500, function () {
                    //execute this after slideToggle is done
                    //change text of header based on visibility of content div
                    $header.text(function () {
                        //change text based on condition
                        //return $content.is(":visible") ? "" : "";
                    });
                });
            });



            $("#chartExpand").click(function () {

                $header = $(this);
                //getting the next element
                $content = $("#weeklyChart");
                //open up the content needed - toggle the slide- if visible, slide up, if not slidedown.
                $content.slideToggle(500, function () {
                    //execute this after slideToggle is done
                    //change text of header based on visibility of content div
                    $header.text(function () {
                        //change text based on condition
                        //return $content.is(":visible") ? "" : "";
                    });
                });
                $("#switchChartButtons").toggle()

            });
            var allGroups = getAllGroups(10);
            var allUsers = getAllUsers(10);
        });
        //console.log("dataWeek: ", dataWeek);
        google.load("visualization", "1", {packages:["corechart"]});
        //console.log("year:", year, "week: ", week);
        google.setOnLoadCallback(drawChart2);
        if (!gameWeekData.year) {
            gameWeekData.year = 2017;
        }
        if (!gameWeekData.week) {
            gameWeekData.week = 18;
        }
        function deferredLeaderboardRequest2(year, week, leaderboardToken, callback) {
            if (!year || !week) { return }
                //var id_token = localStorage.getItem('id_token') || "";
                //console.log("deferredLeaderboardRequest2: ", year, " ", week);
                get("https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/" + year + "/" + week + "/leaderboards",{
                    method: "GET",
                    headers: {
                        'Authorization': leaderboardToken
                    }
                })
                .then(function (response) {
                    return response.json();
                })
                .then(function(leaderboardJSON) {
                    //console.log("leaderboardJSON: ", leaderboardJSON)
                    callback(leaderboardJSON);
                })
        };
            function drawChart2(year, week, view) {
                useToken(function (token) {
                    if (token !== false) {
                        deferredLeaderboardRequest2(year, week, token, buildChart);
                    }
                });
            }

            // $(window).resize(function(){
            //     //console.log("deferredLeaderboardRequest: ", deferredLeaderboardRequest.responseJSON);
            //     if(!view) { var view = "weekly";}
            //     drawChart2(gameWeekData.year, gameWeekData.week, view);
            // });
            var useToken = function (callback) {
                // console.log("useToken id_token: ", id_token)
                if (!id_token) {
                    var cognitoUser = userPool.getCurrentUser();
                    if (cognitoUser !== null) {
                        //console.log("useToken cognitoUser = ", cognitoUser);
                        cognitoUser.getSession(function (err, session) {
                            if (err) {
                                //window.location = '/';
                                console.log("getSession err = ", JSON.stringify(err))
                            }
                            console.log("session = ", session)
                            token = session.getIdToken().getJwtToken();
                            //console.log(decoded);
                            id_token = token;
                            callback(token);
                        });
                    } else {
                        return callback(false);
                    }
                } else {
                    callback(id_token);
                }
            };


            // $("#loginButton").click(function() {
            //     $("#loginModal").modal('show',{
            //         fadeDuration: 100
            //     });
            // });

            function logout () {
                var cognitoUser = userPool.getCurrentUser();
                ga('send','event','login','logout');
                cognitoUser.signOut();
                showLoginButton();
                window.location = '/';
            };
            // $("#logoutButton").click(function() {
            //     console.log("logout clicked")
            //     logout();
            // });

            // $('#btn-logout').click(function() {
            //     logout()
            // });

        </script>

    </head>

    <body>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0&appId=1562547140702907&autoLogAppEvents=1';
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    <!-- Navbar will come here -->

    <!-- end navbar -->
    <!--login modal-->
    <!--<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Log in to PCSM</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                    <div class="row">
                      <div class="col-md-4 col-lg-12" style="border-right: 1px dotted #C2C2C2;padding-right: 30px;" id="loginRegistrationColumn">
                        <!-- Nav tabs --
                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#Login" data-toggle="tab">Login</a></li>
                            <li><a href="#Registration" data-toggle="tab">Registration</a></li>
                        </ul>
                        <!-- Tab panes --
                        <div class="tab-content">
                            <div class="tab-pane active" id="Login">
                                <form role="form" class="form-horizontal">
                                    <div class="form-group">
                                        <fieldset>
                                            E-mail: <input type="text" id="email" placeholder="Enter your e-mail address">
                                            <br>
                                            <br>
                                            Password: <input type="password" id="password" placeholder="Enter password">
                                            <br>
                                            <!--<a href="https://crowdsourcedscores.auth.us-west-2.amazoncognito.com/forgotPassword?response_type=token&client_id=2n15lhk845sucm0k4fejjqcbev&redirect_uri=https://crowdsourcedscores.com">Forgot Password?</a>--
                                            <a href="#" onClick="showForgotPasswordUI()">Forgot Password?</a>
                                            <br>
                                            <!--<div style="width: 90%;">
                                                <button id="loginUser">Log In</button>
                                            </div>--
                                            <ul id="loginUserResults"></ul>
                                            <div class="fb-login-button" data-show-faces="false" data-width="200" data-max-rows="1"></div>
                                        </fieldset>
                                    </div>
                                </form>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" id="loginUser">Login</button><br>
                                </div>
                            </div>
                            <div class="tab-pane" id="Registration">
                                    <form role="form" class="form-horizontal">
                                      <div class="form-group">
                                        <label for="firstName" class="col-sm-2 control-label">
                                                            First</label>
                                        <div class="col-sm-6">
                                          <div class="row">
                                            <div class="col-md-6">
                                              <input type="text" class="form-control" id="firstName" placeholder="First Name" />
                                            </div>
                                          </div>
                                        </div>
                                      </div>
    
                                      <div class="form-group">
                                            <label for="lastName" class="col-sm-2 control-label">
                                                                Last</label>
                                            <div class="col-sm-6">
                                              <div class="row">
                                                <div class="col-md-6">
                                                  <input type="text" class="form-control" id="lastName" placeholder="Last Name" />
                                                </div>
                                              </div>
                                            </div>
                                        </div>
    
                                        <div class="form-group">
                                            <label for="newUsername" class="col-sm-2 control-label">
                                                                Username (max: 25 characters)</label>
                                            <div class="col-sm-10">
                                              <input type="text" class="form-control" id="newUsername" placeholder="Username" />
                                            </div>
                                        </div>
                                      <div class="form-group">
                                        <label for="email" class="col-sm-2 control-label">
                                                            Email</label>
                                        <div class="col-sm-10">
                                          <input type="email" class="form-control" id="newEmail" placeholder="Email" />
                                        </div>
                                      </div>
                                      <div class="form-group">
                                        <label for="newPassword" class="col-sm-2 control-label">
                                                            Password</label>
                                        <div class="col-sm-10">
                                          <input type="password" class="form-control" id="newPassword" placeholder="Password" />
                                        </div>
                                      </div>
                                      <div class="row">
                                        <div class="col-sm-2">
                                        </div>
                                        <div class="col-sm-10">
                                          <button type="button" class="btn btn-primary btn-sm" id="signUpUser">
                                                                Submit</button>
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                        </div>
                                      </div>
                                    </form>
                                  </div>
                                </div>
                        </div>
                        

                    </div>
                </div>
            </div>
        </div>
    </div>-->
    
    <!--close login modal-->
    <!--create crowd modal-->
    <div class="modal fade" id="crowdModal" tabindex="-1" role="dialog" aria-labelledby="crowdModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="crowdModalLabel">Create a Crowd</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-12" id="createCrowdColumn">
                            <form role="form" class="form-horizontal">
                                <div class="form-group">
                                    <fieldset>
                                        <!--<legend>Sign Up for PCSM</legend>-->
                                        <!--User name: <input type="text" id="username" placeholder="Enter your preferred user name">
                                        <br>
                                        <br>-->
                                        <label for="crowdName">Crowd Name:</label> <input class="form-control" type="text" id="crowdName" name="crowdName" placeholder="Your Crowd Name">
                                        <br>
                                        <br>
                                        <label for="crowdPublic">Password Required?</label> <input class="form-control" type="checkbox" id="crowdPublic" name="crowdPublic" onchange="toggleCrowdPassword()">
                                        <div id="crowdPasswordDiv" class="hidden">
                                            <label for="crowdPassword">Crowd Password</label>
                                            <input type="text" name="crowdPassword" id="crowdPassword" class="form-control"/>
                                        </div>
                                        <span id="createCrowdResults"></span>
                                    </fieldset>
                                </div>
                            </form>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" id="createCrowdButton" onclick="createCrowd()">Create!</button><br>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--close create crowd modal-->
    <!--prediction Score Modal-->
    <div class="modal fade" id="predictionScoreModal" tabindex="-1" role="dialog" aria-labelledby="predictionScoreModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="predictionScoreModalLabel">Prediction Scoring</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-12" id="predictionScoreDetails">
                            How we calculate your prediction score:
                            <ul>
                                <li>Pick the Winner: 2 points</li>
                                <li>Pick the Spread: 2 points</li>
                                <li>Pick the Over/Under: 2 points</li>
                                <li>Get any prediction exactly right: 1 point each</li>
                                <li><strong>Maximum Score: 10 points</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<div class="wrapper">
        <!--<div class="header">-->

        <!--</div>-->
        <!-- you can use the class main-raised if you want the main area to be as a page with shadows -->
    <div class="main">
        <div class="container">
            <div class="row">
                <div class="navbar navbar-default navbar-fixed-top">
                    <div class="container">
                        <div class="header-icon"><a href="/"><img src="https://crowdsourcedscores.files.wordpress.com/2016/11/cropped-css-logo-footballleft-webres-1300px.jpg?w=520" alt="Crowd Wisdom Sports"></a></div>
                        <div class="navbar-header"><a href="/" class="navbar-brand"><span class="hidden-md">Crowd Wisdom Sports</span><span class="visible-md">CW Sports</span></a>
                        <button type="button" data-toggle="collapse" data-target="#navbar-main" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
                        </div>
                        <div id="navbar-main" class="navbar-collapse collapse">
                        <ul class="nav navbar-nav">
                            <li class="active"><a href="#">Home</a></li>
                            <li><a href="https://blog.crowdsourcedscores.com/" target="blog">Blog</a></li>
                            <li><a class="dropdown-toggle" data-toggle="dropdown" href="#" id="leaderboards">Leaderboards<span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    <li style="text-align: center"><a href="/crowd.html"><span class="glyphicons glyphicons-group"></span> Groups</a></li>
                                    <li style="text-align: center"><a href="/leaderboard.html"><span><i class="glyphicon glyphicon-user"></i></span> Users</a></li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="podcasts"><i class="fa fa-headphones" aria-hidden="true"></i> Podcast<span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    <li style="text-align: center">
                                        <a target="_blank" href="https://itunes.apple.com/us/podcast/the-crowd-wisdom-sports-podcast/id1331165617?mt=2" style="display:inline-block;overflow:hidden;background:url(https://linkmaker.itunes.apple.com/assets/shared/badges/en-us/podcast-lrg.svg) no-repeat;width:133px;height:34px;background-size:contain;"><span style="height: 34px; width:133px; padding: 16px 0"></span></a>
                                    </li>
                                    <li style="text-align: center">
                                        <a href="https://www.stitcher.com/s?fid=162919&refid=stpr"><img src="https://secureimg.stitcher.com/promo.assets/stitcher-banner-88x31.jpg" width="88" height="31" alt="Listen to Stitcher"></a>
                                    </li>
                                    <li style="text-align: center">
                                        <a target="_blank" href='https://playmusic.app.goo.gl/?ibi=com.google.PlayMusic&amp;isi=691797987&amp;ius=googleplaymusic&amp;apn=com.google.android.music&amp;link=https://play.google.com/music/m/Ikd4ilzctaypo3idfl2admka4ve?t%3DThe_Crowd_Wisdom_Sports_Podcast%26pcampaignid%3DMKT-na-all-co-pr-mu-pod-16' rel='nofollow'><img width='125px' alt='Listen on Google Play Music' src='https://play.google.com/intl/en_us/badges-music/images/badges/en_badge_web_music.png'/></a>
                                    </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="profileName"><span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    <li style="text-align: center"><a href="/profile.html"><span><i class="glyphicon glyphicon-user"></i></span> Profile</a></li>
                                    <li style="text-align: center"><button type="button" class="btn btn-default" id="btn-logout" onclick="logout()">Logout</button></li>
                                </ul>
                            </li>
                        </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row topRow">
                <div class="col-xs-7 col-sm-10">
                    <!--<a href="https://crowdsourcedscores.auth.us-west-2.amazoncognito.com/login?response_type=token&client_id=2n15lhk845sucm0k4fejjqcbev&redirect_uri=https://crowdsourcedscores.com">Login</a>-->
                    
                    <div id="loginButtons"></div>


                    <!-- fieldset for Cognito -->
                    <!--<fieldset>
                        <legend>Sign Up for PCSM</legend>
                        User name: <input type="text" id="username" placeholder="Enter your preferred user name">
                        <br>
                        <br>
                        E-mail: <input type="text" id="email" placeholder="Enter your e-mail address">
                        <br>
                        <br>
                        Password: <input type="password" id="password" placeholder="Enter password">
                        <br>
                        <br>
                        <div style="width:500px;">
                            <button id="loginUser">Log In</button>
                        </div>
                        <ul id="loginUserResults"></ul>
                    </fieldset>-->

                    <div id="dropdown" class="ddmenu">
                    <span class="dropdownSelection">Select Week</span>
                        <ul id="seasonSelector">
                          <li><a href="#">2018</a></li>
                          <li><a href="#">2017</a></li>
                          <li><a href="#">2016</a></li>
                        </ul>
                      </div>
                      <!-- <select class="dropdown" id="seasonSelectorOld">
                        <option value="2018" selected>2018</option>
                        <option value="2017">2017</option>
                        <option value="2016">2016</option>
                    </select> -->
                </div>
                <div class="col-xs-5 col-sm-2">
                    <a href="https://twitter.com/crowdbrains" class="twitter-follow-button" data-show-count="false">Follow @crowdbrains</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><br>
                    <iframe src="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Fcrowdsourcedscores&width=20px&layout=button_count&action=like&size=small&show_faces=false&share=true&height=46&appId=220211628373013" width="160px" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>

                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 weekSelector">

                    <ul id="weekSelector" class="pagination pagination-info">
                        <li><a href="javascript:void(0);" data-week="1">1</a></li>
                        <li><a href="javascript:void(0);" data-week="2">2</a></li>
                        <li><a href="javascript:void(0);" data-week="3">3</a></li>
                        <li><a href="javascript:void(0);" data-week="4">4</a></li>
                        <li><a href="javascript:void(0);" data-week="5">5</a></li>
                        <li><a href="javascript:void(0);" data-week="6">6</a></li>
                        <li><a href="javascript:void(0);" data-week="7">7</a></li>
                        <li><a href="javascript:void(0);" data-week="8">8</a></li>
                        <li><a href="javascript:void(0);" data-week="9">9</a></li>
                        <li><a href="javascript:void(0);" data-week="10">10</a></li>
                        <li><a href="javascript:void(0);" data-week="11">11</a></li>
                        <li><a href="javascript:void(0);" data-week="12">12</a></li>
                        <li><a href="javascript:void(0);" data-week="13">13</a></li>
                        <li><a href="javascript:void(0);" data-week="14">14</a></li>
                        <li><a href="javascript:void(0);" data-week="15">15</a></li>
                        <li><a href="javascript:void(0);" data-week="16">16</a></li>
                        <li><a href="javascript:void(0);" data-week="17">17</a></li>
                        <!-- <li><a href="javascript:void(0);" data-week="18">WC</a></li>
                        <li><a href="javascript:void(0);" data-week="19">DIV</a></li>
                        <li><a href="javascript:void(0);" data-week="20">CONF</a></li>
                        <li><a href="javascript:void(0);" data-week="21">SB</a></li> -->
                        <li><i class="fas fa-chart-bar" aria-hidden="true" id="chartExpand"></i></li>
                    </ul>
                </div>
            </div>
            <div id="chartContainer" class="container">
                <div class="row">
                    <div class="col-xs-12">
                        <div id="weeklyChart" style="display:none"></div>
                        <div class="row" id="switchChartButtons" style="display: none">
                            <div class="col-xs-6">
                                <button id="weeklyChartButton">Weekly Results</button>
                            </div>
                            <div class="col-xs-6">
                                <button id="overallChartButton">Overall Accuracy</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row" id="feedbackDiv">
                    <div class="col-xs-12 col-sm-4"><a href="mailto:feedback@crowdsourcedscores.com">Send Feedback</a></div>
                    <!-- <div class="col-xs-12 col-sm-4" id="contest-div"><a href="https://blog.crowdsourcedscores.com/2018-postseason-contest/how-the-nfl-postseason-contest-works/" target="_blank"><i class="fa fa-trophy" aria-hidden="true"></i> Postseason Contest Details</a></div> -->
                    <div class="col-xs-12 col-sm-4" id="newsletter-signup-div"><i class="fa fa-envelope-open-o" aria-hidden="true"></i> Get Weekly Reminders + a Bonus!</div>
                    <!--<div class="col-xs-12 col-sm-4"><i class="fa fa-trophy" aria-hidden="true"></i>Postseason Contest Rules</a></div>-->
                </div>
                <div class="row" id="newsletter-form-div">
                    <div class="col-xs-12">
                        <!-- Begin MailChimp Signup Form -->
                        <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
                        <style type="text/css">
                            #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif;}
                            /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
                            We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
                        </style>
                        <div id="mc_embed_signup">
                        <form action="https://crowdsourcedscores.us14.list-manage.com/subscribe/post?u=d16f245296d7d248af2da3413&amp;id=cf6ceb921e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                            <div id="mc_embed_signup_scroll">
                            <h2>Get Weekly Reminders + a Bonus!</h2>
                            <p>Get Weekly Reminders to make your picks throughout the regular season to make sure you can stay ahead of the crowd.</p>
                            <p>We are planning on rolling out subscriptions at mid-season, and all Newsletter subscribers will <strong>get a free month</strong> to test the crowd wisdom!</p>
                            <p>We will <span style="color:#B42135; font-weight:bold">NEVER</span> give your information to anyone <span style="color:#B42135;font-weight:bold">EVER</span>.</p>
                        <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
                        <div class="mc-field-group">
                            <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
                        </label>
                            <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
                        </div>
                        <div class="mc-field-group">
                            <label for="mce-FNAME">First Name (optional) </label>
                            <input type="text" value="" name="FNAME" class="" id="mce-FNAME">
                        </div>
                        <div class="mc-field-group">
                            <label for="mce-LNAME">Last Name (optional) </label>
                            <input type="text" value="" name="LNAME" class="" id="mce-LNAME">
                        </div>
                            <div id="mce-responses" class="clear">
                                <div class="response" id="mce-error-response" style="display:none"></div>
                                <div class="response" id="mce-success-response" style="display:none"></div>
                            </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                            <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_d16f245296d7d248af2da3413_cf6ceb921e" tabindex="-1" value=""></div>
                            <div class="clear"><input style="background-color: #B42135" type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                            </div>
                        </form>
                        </div>
                        <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
                        <!--End mc_embed_signup-->
                    </div>
                </div>
            </div>

            <div id="resultsContainer">

                <div class="row" id="myResultsRow">
                    <div class="col-xs-12 col-sm-1">
                        <span>You:</span>
                    </div>
                    <div class="col-xs-3 col-sm-2">
                        <span class="hidden-xs">Winners:</span><span class="visible-xs">Wins:</span> <span id="myStraightUpResults"></span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Spread:</span><span class="visible-xs">ATS:</span> <span id="mySpreadResults"></span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Over/Under:</span><span class="visible-xs">O/U:</span> <span id="myTotalResults"></span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Prediction Score:</span><span class="visible-xs">Score:</span> <span id="myPredictionScore"></span>
                    </div>
                </div>
                <div class="row" id="crowdResultsRow">
                    <div class="col-xs-12 col-sm-1">
                        <span>Crowd:</span>
                    </div>
                    <div class="col-xs-3 col-sm-2">
                        <span class="hidden-xs">Winners:</span><span class="visible-xs">Wins:</span> <span id="crowdStraightUpResults"></span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Spread:</span><span class="visible-xs">ATS:</span> <span id="crowdSpreadResults"></span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Over/Under:</span><span class="visible-xs">O/U:</span> <span id="crowdTotalResults"></span>
                    </div>
                    <div class="col-xs-3">
                        <span class="hidden-xs">Prediction Score:</span><span class="visible-xs">Score:</span> <span id="crowdPredictionScore"></span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12 col-md-8">
                        <div class="cont">
                            <div class="progress">
                                <div class="progress-bar" id="progress-bar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" role="progressbar"></div>
                            </div>
                            <p><strong>Prediction Progress:</strong> <span class="percent"></span></p>
                            <div id="legend">
                                <span class="alert alert-success">&nbsp;</span>: Correct Pick | <i class="fas fa-bullseye"></i>: Bullseye Prediction
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    <div id="games-loading-icon">
                        <i class="fa fa-cog fa-spin fa-3x fa-fw"></i>
                        <span class="sr-only">Loading...</span>
                    </div>

                    <div id="games"></div>
                </div>
                <div class="col-sm-12 col-md-4" id="competitionDiv">
                    <div class="bs-example bs-example-tabs" role="tabpanel" data-example-id="togglable-tabs">
                            <ul id="myTab" class="nav nav-tabs nav-tabs-responsive" role="tablist">
                                <li role="presentation" class="active">
                                <a href="#usersDiv" id="users-tab" role="tab" data-toggle="tab" aria-controls="users" aria-expanded="true">
                                    <span class="text">User Leaderboard</span>
                                </a>
                                </li>
                                <li role="presentation" class="next">
                                <a href="#crowdsDiv" role="tab" id="crowds-tab" data-toggle="tab" aria-controls="crowds">
                                    <span class="text">Crowd Leaderboard</span>
                                </a>
                                </li>
                            </ul>
                        <div id="myTabContent" class="tab-content">
                            <div role="tabpanel" class="tab-pane fade in active" id="usersDiv" aria-labelledby="home-tab">
                                <div id="allUsers"></div>
                                <button type="button" class="btn btn-primary" id="leaderboardButton" onclick="window.location='/leaderboard.html'">Leaderboard</button>
                            </div>
                            <div role="tabpanel" class="tab-pane fade" id="crowdsDiv" aria-labelledby="groups-tab">
                                <div id="allGroups"></div>
                                <div id="createCrowdButtonDiv"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12" style="font-size: 0.8em">
                    All odds are provided by <a href="https://www.oddsshark.com" style="color:#B42135" target="_blank">Oddsshark.com</a> and are locked one hour prior to kickoff.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var cognitoUser = userPool.getCurrentUser();
    var attributeList = [];

    var dataEmail = {
        Name : 'email',
        Value : 'email@mydomain.com'
    };

    var dataUsername = {
        Name : 'preferred_username',
        Value : 'email@mydomain.com'
    };
    var attributeEmail = new AmazonCognitoIdentity.CognitoUserAttribute(dataEmail);
    var attributeUsername = new AmazonCognitoIdentity.CognitoUserAttribute(dataUsername);
    // document.getElementById('loginUser').addEventListener('click', function () {
    //   userPool.signUp(document.getElementById('username').value, document.getElementById('password').value,
    //     attributeList, null,
    //     function (err, result) {
    //         if (err) {
    //             alert(JSON.stringify(err));
    //             return;
    //         }
    //         document.getElementById('signupUserResults').innerHTML = "Results: " + JSON.stringify(
    //           result.user, null, 2);
    //         cognitoUser = result.user;
    //         console.log(cognitoUser);
    //     });
    // });

    $("#loginUser").click(function() {
        login();
    });
    var login = function () {
        var email = $('#email').val();
        var authenticationData = {
            Username: email,
            Password: $('#password').val()
        };

        var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);
        var userData = {
            Username: email,
            Pool: userPool
        };
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
        cognitoUser.authenticateUser(authenticationDetails, {
            onSuccess: function () {
                $("#loginModal").modal("hide");
                showLogoutButton();
                getGameWeek(setGameWeek)
            },
            onFailure: function (err) {
                console.log(JSON.stringify(err))
                alert(JSON.stringify(err));
                if (err.code === "NotAuthorizedException") {
                    console.log(CognitoUser.resendConfirmationCode(email))
                    // CognitoUser.resendConfirmationCode(userData)
                    // .then(function(result) {
                    //     console.log(`Resend result ${result}`)
                    // })
                    // .catch(function(err) {
                    //     console.log(`Resend error: ${err}`)
                    // })
                    
                    //var tempUser = getUser();
                    //console.log(`tempUser = ${tempUser}`)
                }
            }
        });
    }



    // Commenting out and will remove once login flow is confirmed

    // document.getElementById('signUpUser').addEventListener('click', function() {
    //     console.log('clicked');
    //     var attributeList = [];
        
    //     var dataEmail = {
    //             Name : 'email',
    //             Value : $('#newEmail').val()
    //         };

    //     var attributeEmail = new AmazonCognitoIdentity.CognitoUserAttribute(dataEmail);
    //     attributeList.push(attributeEmail);
        
    //     var dataFirst = {
    //             Name : 'given_name',
    //             Value : $('#firstName').val()
    //         };

    //     var attributeFirst = new AmazonCognitoIdentity.CognitoUserAttribute(dataFirst);
    //     attributeList.push(dataFirst);

    //     var dataLast = {
    //             Name : 'family_name',
    //             Value : $('#lastName').val()
    //         };

    //     var attributeFirst = new AmazonCognitoIdentity.CognitoUserAttribute(dataLast);
    //     attributeList.push(dataLast);

    //     // var dataUsername = {
    //     //         Name : 'username',
    //     //         Value : document.getElementById('newUsername').value()
    //     //     };

    //     // var attributeFirst = new AmazonCognitoIdentity.CognitoUserAttribute(dataUsername);
    //     // attributeList.push(dataUsername);

    //     // var dataPassword = {
    //     //         Name : 'password',
    //     //         Value : document.getElementById('newPassword').value()
    //     //     };

    //     // var attributeFirst = new AmazonCognitoIdentity.CognitoUserAttribute(dataPassword);
    //     // attributeList.push(dataPassword);

    //     var cognitoUser;

    //     userPool.signUp($('#newUsername').val(), $('#newPassword').val(), attributeList, null, function(err, result) {
    //         if (err) {
    //             alert(err);
    //             return;
    //         }
    //         cognitoUser = result.user;

    //         console.log('user name is ' + cognitoUser.getUsername());
    //         showConfirmUI(cognitoUser);
    //     });
    // });

    function showConfirmUI(cognitoUser) {
        $("#loginRegistrationColumn").html("<h1>Welcome " + cognitoUser.getUsername() + "!</h1><p>We have sent a confirmation code to the email address that you provided.</p><div><label for=\"confirmUserCode\">Enter your confirmation code:</label><input type=\"number\" id=\"confirmUserCode\"><button class=\"btn btn-primary btn-sm\" id=\"confirmUser\" onclick=\"confirmUser('" + cognitoUser.getUsername() + "')\">Confirm</button><br><a href=\"#\" id=\"resendCode\" onclick=\"resetVerificationPIN('" + cognitoUser.getUsername() + "')\">Resend Confirmation Code</a></div>")
    }


    function confirmUser(username) {

        var userData = {
            Username: username,
            Pool: userPool
        };
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
        
        cognitoUser.confirmRegistration($('#confirmUserCode').val(), true, function (err, results) {
            if (err) {
                alert(err);
            } else {
                window.location = '/';
            }
        });
    };

    
    function resetVerificationPIN(username){
        const p = new Promise((res, rej)=>{
        
        var userData = {
            Username: username,
            Pool: userPool
        };
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

        cognitoUser.resendConfirmationCode(function(err, result) {
            if (err) {
                rej(err)
                return
            }
                res()
            })
        });
    };

    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    };

    function showForgotPasswordUI() {
        $("#loginRegistrationColumn").html("<div>Please provide your e-mail address and, if it exists in our system, we will send you a link to reset your password.<br><label for=\"forgotPasswordEmail\">Enter your e-mail address:</label><input type=\"email\" id=\"forgotPasswordEmail\"><button class=\"btn btn-primary btn-sm\" id=\"forgotPasswordButton\" onclick=\"forgotPassword()\">Reset Password</button><br></div>")
    }


    function forgotPassword() { 

        var forgotPasswordEmail = $('#forgotPasswordEmail').val()
        var userData = {
            Username: forgotPasswordEmail,
            Pool: userPool
        };
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

        cognitoUser.forgotPassword({
            onSuccess: function (result) {
                console.log('call result: ' + result);
                $("#loginRegistrationColumn").html("<div>Enter the confirmation code sent to the e-mail address you provided and your new password.<br><label for=\"forgotPasswordConfirmationCode\">Confirmation Code:</label><input type=\"number\" id=\"forgotPasswordConfirmationCode\"><br><label for=\"forgotPasswordNewPassword\">New Password</label><input type=\"password\" id=\"forgotPasswordNewPassword\"><button class=\"btn btn-primary btn-sm\" id=\"changePasswordButton\" onclick=\"inputVerificationCode('" + forgotPasswordEmail + "')\">Reset Password</button><br></div>")
            },
            onFailure: function(err) {
                console.log(JSON.stringify(err));
            }
        });


        // cognitoUser.confirmRegistration($("#confirmUserCode").val(), true, function(err, result) {
        //         if (err) {
        //             alert(JSON.stringify(err));
        //             return;
        //         }
        //         alert("result: ", JSON.stringify(result));
        //     });
    };

    function inputVerificationCode(userEmail) {
        var userData = {
            Username: userEmail,
            Pool: userPool
        }
    var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
        var verificationCode = $('#forgotPasswordConfirmationCode').val();
        var newPassword = $('#forgotPasswordNewPassword').val();
        
        cognitoUser.confirmPassword(verificationCode, newPassword, {
            onFailure(err) {
                console.log(err);
            },
            onSuccess() {
                $("#loginRegistrationColumn").html("<form role=\"form\" class=\"form-horizontal\"><div class=\"form-group\"><fieldset>E-mail: <input type=\"text\" id=\"email\" placeholder=\"Enter your e-mail address\"><br><br>Password: <input type=\"password\" id=\"password\" placeholder=\"Enter password\"><br><a href=\"#\" onClick=\"showForgotPasswordUI()\">Forgot Password?</a><br><ul id=\"loginUserResults\"></ul><div class=\"fb-login-button\" data-show-faces=\"false\" data-width=\"200\" data-max-rows=\"1\"></div></fieldset></div></form><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button><button type=\"button\" class=\"btn btn-primary\" id=\"loginUser\" onclick=\"login()\">Login</button><br></div>");
            }
        });
    }


</script>
    <script type="text/javascript" src="assets/js/lib/axios/dist/axios.standalone.js"></script>
    <script type="text/javascript" src="assets/js/lib/CryptoJS/rollups/hmac-sha256.js"></script>
    <script type="text/javascript" src="assets/js/lib/CryptoJS/rollups/sha256.js"></script>
    <script type="text/javascript" src="assets/js/lib/CryptoJS/components/hmac.js"></script>
    <script type="text/javascript" src="assets/js/lib/CryptoJS/components/enc-base64.js"></script>
    <script type="text/javascript" src="assets/js/lib/url-template/url-template.js"></script>
    <script type="text/javascript" src="assets/js/lib/apiGatewayCore/sigV4Client.js"></script>
    <script type="text/javascript" src="assets/js/lib/apiGatewayCore/apiGatewayClient.js"></script>
    <script type="text/javascript" src="assets/js/lib/apiGatewayCore/simpleHttpClient.js"></script>
    <script type="text/javascript" src="assets/js/lib/apiGatewayCore/utils.js"></script>
    <script type="text/javascript" src="assets/js/apigClient.js"></script>
    <script type="text/javascript">
    
    var apiClient = apigClientFactory.newClient();
    
    </script>
    <script type="text/javascript" src="assets/js/index.js"></script>
    <footer>
        Copyright &copy;2018 PCSM, LLC
    </footer>
</body>

</html>
