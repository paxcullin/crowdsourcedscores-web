<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/crowdsourcedscores-icon.png">
    <link rel="icon" type="image/png" href="assets/img/crowdsourcedscores-icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="description" content="Beating the sportsbooks with the Wisdom of the Crowd NFL Score Predictions">
    <meta name="keywords" content="football,crowdsourced,wisdom,wisdom of the crowd,sportsbook,spread,total,moneyline">
    <base href="https://crowdsourcedscores.com">

    <title>Crowdsourced Scores - Group Page</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>

    <!--     Fonts and icons     -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css"/>

    <!-- CSS Files -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="assets/css/material-kit.css" rel="stylesheet"/>
    <style type="text/css">
        .card .content {
            padding-left:5px;
            padding-right: 5px;
        }
        .table > thead > tr > th,
        .table > thead > tr > td {
            padding: 5px;
            text-align: center;
        }
        .container {
            padding-left: 5px;
            padding-right: 5px;
        }
        .form-control {
            /*padding-left:27px;
            padding-top: 9px;*/
            padding: 0;
            margin: 0 7px;
            text-align: center;
            height: auto;
            /*border: 1px solid #B22438;
            background-color: #B22438;
            color: #fff;*/
            background-image: linear-gradient(#9c27b0, #9c27b0), linear-gradient(#B22438, #B22438);
        }
        #fbSection {
            margin: 5px 10px;
        }
        #fbSection img {
            float:left;
            padding-right: 10px;
        }
        .fbName {
            margin: 10px 0;
        }
        /* Dropdown Button */
        .dropbtn {
            background-color: #4CAF50;
            color: white;
            padding: 16px;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        /* The container <div> - needed to position the dropdown content */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        /* Dropdown Content (Hidden by Default) */
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }

        /* Links inside the dropdown */
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        /* Change color of dropdown links on hover */
        .dropdown-content a:hover {background-color: #f1f1f1}

        /* Show the dropdown menu on hover */
        .dropdown:hover .dropdown-content {
            display: block;
        }

        /* Change the background color of the dropdown button when the dropdown content is shown */
        .dropdown:hover .dropbtn {
            background-color: #3e8e41;
        }

        .navbar, .navbar.navbar-default {
            background-color: #3A3B6C;
        }

        .header-icon {
            float:left;
            margin-right:10px;
        }
        .header-icon img {
            width: 60px;
        }
        .topRow {
            padding-top: 90px;
        }
        .gameHeaderPredicted {
            background-color:#3A3B6C;
            color:#fff;
        }
        .gameHeaderNotPrediction {
            border:1px solid #3A3B6C;
        }

        .crowdCorrect {
            color: #55b559;
            font-weight: bold;
        }

        .crowdHidden {
            visibility: hidden;
        }

        #resultsContainer {
            color:#fff;
            display:none;
            font-weight: bold;
            font-size: 1.2em;
            padding-bottom: 15px;
        }
        #myResultsRow {
            background-color: #B42135;
            border: 1px solid #B42135;
            margin: 0 15px;
        }

        #crowdResultsRow {
            background-color:#3A3B6C;
            color:#fff;
            margin: 0 15px;
        }

        .finalRow {
            background-color: #000;
            color:#fff;
            font-weight: bold;
            font-size: 1.1em;
            padding: 5px 15px;
            text-align: center;
        }
        #chartExpand {
            padding-top: 8px;
        }
        #weeklyChart {
            
            padding: 5px;
        }
        #switchChartButtons {
            margin: 10px 0;
        }
        #switchChartButtons button {
            font-size: 1.1em;
            font-weight: bold;
        }
        #weeklyChartButton {
            color: #fff;
            background-color: #B42135;
            margin: 0 auto;
            float: right;
        }
        #overallChartButton {
            color: #fff;
            background-color: #3A3B6C;
            margin: 0 auto;
        }
        #feedbackDiv {
            margin: 10px auto;
            text-align: center;
        }
        #feedbackDiv a {
            color:#3A3B6C
        }

        @media(max-width:768px) {
            #resultRow {
                text-align: center;
            }
        }

        .loading-icon {
            position: relative;
            width: 20px;
            height: 20px;
            margin:50px auto;
            -webkit-animation: fa-spin 2s infinite linear;
            animation: fa-spin 2s infinite linear;
            text-align: center;
        }

        .loading-icon:before {
            content: "\f110";
            font-family: FontAwesome;
            font-size:20px;
            position: absolute;
            top: 0;
        }
        #newsletter-form-div {
            display:none;
        }

        div#OR {
            height: 30px;
            width: 30px;
            border: 1px solid #C2C2C2;
            border-radius: 50%;
            font-weight: bold;
            line-height: 28px;
            text-align: center;
            font-size: 12px;
            float: right;
            position: absolute;
            right: -16px;
            top: 40%;
            z-index: 1;
            background: #DFDFDF;
        }

    </style>


    <!--   Core JS Files   -->
    <script src="assets/js/jquery.min.js" type="text/javascript"></script>



    <script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="assets/js/material.min.js"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="assets/js/nouislider.min.js" type="text/javascript"></script>

    <!--  Plugin for the Datepicker, full documentation here: http://www.eyecon.ro/bootstrap-datepicker/ -->
    <script src="assets/js/bootstrap-datepicker.js" type="text/javascript"></script>

    <!-- Control Center for Material Kit: activating the ripples, parallax effects, scripts from the example pages etc -->
    <script src="assets/js/material-kit.js" type="text/javascript"></script>

    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>-->


    <script>
            //Auth0 Google Analytics script
                    // 'google-analytics': {
                    //     id: 'UA-69748662-2'
                    // }
                    // preloaded: true

        window.auth0AnalyticsOptions = {
            'google-analytics': {
                id: 'UA-69748662-2'
            }
        }
        
    </script>
        <!-- Auth0 lock script -->
        <script src="//cdn.auth0.com/js/lock/10.15/lock.min.js"></script>
        <script src="//cdn.auth0.com/js/analytics/1.3.0/analytics.min.js"></script>
        <!--End Auth0 Google Analytics script-->

        <script>
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
                
                ga('create', 'UA-69748662-2', 'auto');
                ga('send', 'pageview');
            </script>
    <!-- Handlebars.js -->
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.js"></script>
        <!--Cognito Code-->
        <script type="text/javascript" src="assets/js/amazon-cognito-identity.js"></script>
        <!--End Cognito Code-->
        <!--JWT Decode Script-->
        <script src="assets/js/jwt-decode.min.js"></script>
        <script>
            function GetURLParameter(sParam) {
                var sPageURL = window.location.hash.substring(1);
                var sURLVariables = sPageURL.split('&');
                for (var i = 0; i < sURLVariables.length; i++) {
                    var sParameterName = sURLVariables[i].split('=');
                    if (sParameterName[0] == sParam) {
                        return sParameterName[1];
                    }
                }
            }
            var decoded = {};
            var idToken = "";
            function processToken() {
                idToken = GetURLParameter('id_token');
                if (!idToken) {
                    console.log('No id_token present');
                    return;
                }
                decoded = jwt_decode(idToken);
                console.log(decoded);
                return decoded;
            }
        </script>
        <!--End JWT Decode Script-->

            <script type="text/javascript">


        // GET cognitoUser Information at the top
        //var tokenFromURL = processToken();
        // Pool ID and Client ID sourced from AWS
        var cognitoData = {
            UserPoolId: 'us-west-2_zym3aCbQ3',     // Insert your user pool id
            ClientId: '2n15lhk845sucm0k4fejjqcbev' // Insert your app client id
        };
        var userPool = new AmazonCognitoIdentity.CognitoUserPool(cognitoData);


        var userData = {
            Username : '',
            Pool : userPool
        };
        var id_token = "";


        //GET CURRENT USER FROM LOCAL STORAGE
        var cognitoUser = userPool.getCurrentUser();

        if (cognitoUser) {
            userData = {
                Username : cognitoUser.username,
                Pool : userPool
            };
        }
        
        if (!cognitoUser && GetURLParameter('id_token')) {
            var decodedToken = processToken();
            
            
            userData = {
                Username : decoded["cognito:username"],
                Pool : userPool
            }
            cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
            localStorage.setItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.LastAuthUser', decoded["cognito:username"]);
            localStorage.setItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.' + decoded["cognito:username"] + '.idToken', GetURLParameter("id_token"));
            localStorage.setItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.' + decoded["cognito:username"] + '.accessToken', GetURLParameter("access_token"));
            
            var localToken = localStorage.getItem('CognitoIdentityServiceProvider.' + cognitoData.ClientId + '.LastAuthUser');
            cognitoUser = userPool.getCurrentUser();
            //check for expiration of token
            // if (cognitoUser && decoded.exp < Date.now()) {
            //     userPool.makeUnauthenticatedRequest('initiateAuth', {
            //         ClientId: cognitoData.ClientId,
            //         AuthFlow: 'REFRESH_TOKEN_AUTH',
            //         AuthParameters: {
            //             'REFRESH_TOKEN': '' // client refresh JWT
            //         }
            //     }, (err, authResult) => {
            //         if (err) {
            //             throw err
            //         }
            //         console.log(authResult) // contains new session
            //         })
            // }
        }


        function showLoginButton() {
            $("#loginButtons").html("<button type=\"button\" class=\"btn btn-primary\" onclick=\"window.location=('https://crowdsourcedscores.auth.us-west-2.amazoncognito.com/login?response_type=token&client_id=2n15lhk845sucm0k4fejjqcbev&redirect_uri=https://crowdsourcedscores.com')\">Login/Sign Up</button>");
        }

        function showLogoutButton() {

            $("#loginButtons").html("<button id=\"logoutButton\" onclick=\"console.log('logout clicked');logout()\" class=\"btn btn-primary\">Log Out</button>");
        }

        if (cognitoUser) {
            cognitoUser.getSession(function(err, session) {
                if (err) {
                    console.log("getSession: " + JSON.stringify(err));
                    return;
                }
                //console.log('session validity: ' + session.isValid());
                id_token = cognitoUser.signInUserSession.idToken.jwtToken;
            });

        }


        Handlebars.registerHelper('grouped_each', function(every, context, options) {
            var out = "", subcontext = [], i;
            if (context && context.length > 0) {
                for (i = 0; i < context.length; i++) {
                    if (i > 0 && i % every === 0) {
                        out += options.fn(subcontext);
                        subcontext = [];
                    }
                    subcontext.push(context[i]);
                }
                out += options.fn(subcontext);
            }
            return out;
        });

        Handlebars.registerHelper('ifCond', function (v1, operator, v2, options) {

            switch (operator) {
                case '==':
                    return (v1 == v2) ? options.fn(this) : options.inverse(this);
                case '===':
                    return (v1 === v2) ? options.fn(this) : options.inverse(this);
                case '!=':
                    return (v1 != v2) ? options.fn(this) : options.inverse(this);
                case '!==':
                    return (v1 !== v2) ? options.fn(this) : options.inverse(this);
                case '<':
                    return (v1 < v2) ? options.fn(this) : options.inverse(this);
                case '<=':
                    return (v1 <= v2) ? options.fn(this) : options.inverse(this);
                case '>':
                    return (v1 > v2) ? options.fn(this) : options.inverse(this);
                case '>=':
                    return (v1 >= v2) ? options.fn(this) : options.inverse(this);
                case '&&':
                    return (v1 && v2) ? options.fn(this) : options.inverse(this);
                case '||':
                    return (v1 || v2) ? options.fn(this) : options.inverse(this);
                default:
                    return options.inverse(this);
            }
        });
            </script>

    
    
    <script src="https://www.google.com/jsapi" type="text/javascript"></script>

    <script>

        function get(url, options) {
            console.log("get called: ", url);
            console.log("options: ", JSON.stringify(options));
            return fetch(url, options);
        }

        var getGameWeek = function (callback) {
            useToken(function(token) {
                console.log("getGameWeek token: ", token);
                var getGameWeekURL = "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/week";
                var getGameWeekURLOptions = {
                    method: "GET",
                    headers: {
                        'Authorization': token
                    }
                }
                if (token === false) {
                    getGameWeekURL = "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/week/anon"
                    getGameWeekURLOptions = {
                        method: "GET"
                    }
                }
                get(getGameWeekURL, getGameWeekURLOptions)
                .then(function(response) {
                    return response.json();
                })
                .then(function (data) {
                    data.year = 2017;
                    console.log("gameWeek data: ", data);
                    return callback(data);
                })
                .catch(function(err) {
                    console.log("Error: ", err);
                    return;
                });
            });
        };

        var formatGameTimes = function (games) {
            for (var i = 0; i < games.length; i++) {
                var gameDate = new Date(games[i].startDateTime);
                var options = { weekday: 'long', year: 'numeric', month: '2-digit', day: '2-digit', hour: 'numeric', minute: 'numeric', timeZoneName: 'short' };
                games[i].startDateTime = gameDate.toLocaleString('en-US', options);
            }
            return games;
        }


        var setGameWeek = function (gameWeekData) {

            useToken(function(token) {
                console.log("setGameWeek token: ", token)
                // $.ajax({
                //     url: "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/" + year + "/" + week + "/games",
                //     type: "GET",
                //     beforeSend: function (xhr) {
                //         xhr.setRequestHeader('Authorization', id_token);
                //     },
                var setGameWeekURL = "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/" + gameWeekData.year + "/" + gameWeekData.week + "/games";
                var setGameWeekGetOptions = 
                    {     
                        method: "GET",
                        headers: {
                                'Authorization': token
                        }
                    }
                    // creating anonymous API call for games
                if (token === false) {
                    setGameWeekURL = "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/" + gameWeekData.year + "/" + gameWeekData.week + "/games/anon";
                    setGameWeekGetOptions = {     
                        method: "GET"
                    }
                }
                get(setGameWeekURL, setGameWeekGetOptions)
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                        $("#games-loading-icon").css("display","none")
                        formatGameTimes(data);
                        var games = {games: data};
                        var template = $('#games-template').html();
                        var templateScript = Handlebars.compile(template);
                        var html = templateScript(games);
                        $('#games').html(html);
                        //drawChart2(year, week);
                        $('.prediction-btn').on('click', function (e) {
                            e.preventDefault();
                            $(this).text('Saving...');
                            var $prediction = $(this).parents('.prediction');
                            var prediction = {
                                gameId: $prediction.attr('data-game-id'),
                                gameWeek: $prediction.attr('data-game-week'),
                                year: $prediction.attr('data-game-year'),
                                awayTeam: {
                                    code: $prediction.attr('data-away-code'),
                                    fullName: $prediction.attr('data-away-name'),
                                    shortName: $prediction.attr('data-away-short')
                                },
                                homeTeam: {
                                    code: $prediction.attr('data-home-code'),
                                    fullName: $prediction.attr('data-home-name'),
                                    shortName: $prediction.attr('data-home-short')
                                }
                            };

                            var awayTeamPrediction = $prediction.find('.away-team-prediction input').val();
                            var homeTeamPrediction = $prediction.find('.home-team-prediction input').val();

                            var away = $prediction.attr('data-away-team');
                            var home = $prediction.attr('data-home-team');

                            var awayCode = $prediction.attr('data-away-code');
                            var homeCode = $prediction.attr('data-home-code');

                            prediction.awayTeam.score = parseInt(awayTeamPrediction);
                            prediction.homeTeam.score = parseInt(homeTeamPrediction);

                            submitPrediction(prediction, $(this));
                            // Update prediction table cell
                            //$('#' + awayCode + '-prediction').text(prediction.awayTeam.score);
                            //$('#' + homeCode + '-prediction').text(prediction.homeTeam.score);
                            $('#' + awayCode + homeCode + '-total-prediction').text(prediction.awayTeam.score + prediction.homeTeam.score);
                            $('#' + awayCode + homeCode + '-spread-prediction').text(prediction.awayTeam.score - prediction.homeTeam.score);
                            //show odds and crowd info
                            $prediction.find('.crowdHidden').removeClass('crowdHidden');
                            $prediction.find('.crowdShown').addClass('crowdHidden').removeClass('crowdShown');
                        });
                        return data;
                    })
                    .catch(function (jqXHR, textStatus, errorThrown) {
                        console.log("Error getting games: ", jqXHR, textStatus, errorThrown);
                        if (jqXHR.status == 0) {
                            lock.show();
                        }
                    })
                    .then(function (data) {
                        getWeeklyResults(data);
                        return data;
                    })
                    .then(function (data) {
                        getWeeklyCrowdResults(data)
                        return data;
                    })
                    .then(function(data) {
                       drawChart2(data[0].year, data[0].gameWeek, "weekly");
                    });
            });
        };

        //jQuery for animating boxes after they're predicted

 
        var setUserProfile = function (profile) {
            // Display user information in the UI somewhere

            // Used for editing
            var user_id = profile.user_id;
            // ...
            //document.getElementById('avatar').src = profile.picture;

        };

        var gameWeekData = {};
        $(document).ready(function () {

            if (cognitoUser) {
                showLogoutButton();
            } else {
                showLoginButton();
            }

            $('#weekSelector li').on('click', 'a', function () {
                gameWeekData.year = parseInt(document.getElementById('seasonSelector').value);
                gameWeekData.week = parseInt($(this).attr('data-week'));
                $("#games-loading-icon").css("display","block")
                $('#weekSelector li').removeClass('active');
                $('#resultsContainer').css('display','none');
                $(this).parent('li').addClass('active');
                setGameWeek(gameWeekData);
                //deferredLeaderboardRequest2(gameWeekData.year, gameWeekData.week, id_token, buildChart);
            });

            console.log("gameWeekData.week: ", gameWeekData.week);

            setTimeout(function () {
                getGameWeek(function (data) {
                    console.log("data: ", data);
                    if (data) {
                        week = data.week;
                        year = parseInt(document.getElementById('seasonSelector').value);
                        if (data.year) {
                            year = data.year;
                        }
                        var $selectorElm = $('*[data-week="' + week + '"]');
                        $selectorElm.parent('li').addClass('active');
                        $("#weeklyChartButton").attr({"year":year,"week": week});
                        $("#overallChartButton").attr({"year":year,"week": week});
                        setGameWeek(data);
                        //deferredLeaderboardRequest2(year, week, id_token, buildChart);
                    }
                });
            }, 1000);

            $('#newsletter-signup-div').click(function () {
                ga('send','event','newsletter','viewed');

                $header = $(this);
                //getting the next element
                $content = $("#newsletter-form-div");
                //open up the content needed - toggle the slide- if visible, slide up, if not slidedown.
                $content.slideToggle(500, function () {
                    //execute this after slideToggle is done
                    //change text of header based on visibility of content div
                    $header.text(function () {
                        //change text based on condition
                        //return $content.is(":visible") ? "" : "";
                    });
                });
            });

            $('#mc-embedded-subscribe').click(function () {
                ga('send','event','newsletter','subscribed');

                $header = $(this);
                //getting the next element
                $content = $("#newsletter-form-div");
                //open up the content needed - toggle the slide- if visible, slide up, if not slidedown.
                $content.slideToggle(500, function () {
                    //execute this after slideToggle is done
                    //change text of header based on visibility of content div
                    $header.text(function () {
                        //change text based on condition
                        //return $content.is(":visible") ? "" : "";
                    });
                });
            });


            if (cognitoUser) {document.getElementById('profileName').innerText = cognitoUser.username;}


            var btn_logout = document.getElementById('btn-logout');

            // btn_login.addEventListener('click', function() {
            // lock.show();
            // });

        });
           var useToken = function (callback) {
                if (!id_token) {
                    var cognitoUser = userPool.getCurrentUser();
                    if (cognitoUser !== null) {
                        console.log("useToken cognitoUser = ", cognitoUser);
                        cognitoUser.getSession(function (err, session) {
                            if (err) {
                                //window.location = '/';
                                console.log("getSession err = ", JSON.stringify(err))
                            }
                            console.log("session = ", session)
                            token = session.getIdToken().getJwtToken();
                            id_token = token;
                            callback(token);
                        });
                    } else {
                        return callback(false);
                    }
                } else {
                    callback(id_token);
                }
            };


            $("#loginButton").click(function() {
                $("#loginModal").modal('show',{
                    fadeDuration: 100
                });
            });

            var logout = function () {
                var cognitoUser = userPool.getCurrentUser();
                cognitoUser.signOut();
                showLoginButton();
                window.location = '/';
            };
            $("#logoutButton").click(function() {
                console.log("logout clicked")
                logout();
            });
        </script>

    </head>

    <body>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0&appId=1562547140702907&autoLogAppEvents=1';
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    <!-- Navbar will come here -->

    <!-- end navbar -->
    <!--login modal-->
    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Log in to PCSM</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                    <div class="row">
                      <div class="col-md-4" style="border-right: 1px dotted #C2C2C2;padding-right: 30px;">
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#Login" data-toggle="tab">Login</a></li>
                            <li><a href="#Registration" data-toggle="tab">Registration</a></li>
                        </ul>
                        <!-- Tab panes -->
                        <div class="tab-content">
                            <div class="tab-pane active" id="Login">
                                <form role="form" class="form-horizontal">
                                    <div class="form-group">
                                        <fieldset>
                                            <!--<legend>Sign Up for PCSM</legend>-->
                                            <!--User name: <input type="text" id="username" placeholder="Enter your preferred user name">
                                            <br>
                                            <br>-->
                                            E-mail: <input type="text" id="email" placeholder="Enter your e-mail address">
                                            <br>
                                            <br>
                                            Password: <input type="password" id="password" placeholder="Enter password">
                                            <br>
                                            <br>
                                            <!--<div style="width: 90%;">
                                                <button id="loginUser">Log In</button>
                                            </div>-->
                                            <ul id="loginUserResults"></ul>
                                            <div class="fb-login-button" data-show-faces="false" data-width="200" data-max-rows="1"></div>
                                        </fieldset>
                                    </div>
                                </form>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" id="loginUser">Login</button>
                                </div>
                            </div>
                            <div class="tab-pane" id="Registration">
                                    <form role="form" class="form-horizontal">
                                      <div class="form-group">
                                        <label for="firstName" class="col-sm-2 control-label">
                                                            First</label>
                                        <div class="col-sm-6">
                                          <div class="row">
                                            <div class="col-md-6">
                                              <input type="text" class="form-control" id="firstName" placeholder="First Name" />
                                            </div>
                                          </div>
                                        </div>
                                      </div>
    
                                      <div class="form-group">
                                            <label for="lastName" class="col-sm-2 control-label">
                                                                Last</label>
                                            <div class="col-sm-6">
                                              <div class="row">
                                                <div class="col-md-6">
                                                  <input type="text" class="form-control" id="lastName" placeholder="Last Name" />
                                                </div>
                                              </div>
                                            </div>
                                        </div>
    
                                        <div class="form-group">
                                            <label for="newUsername" class="col-sm-2 control-label">
                                                                Username (max: 25 characters)</label>
                                            <div class="col-sm-10">
                                              <input type="text" class="form-control" id="newUsername" placeholder="Username" />
                                            </div>
                                        </div>
                                      <div class="form-group">
                                        <label for="email" class="col-sm-2 control-label">
                                                            Email</label>
                                        <div class="col-sm-10">
                                          <input type="email" class="form-control" id="newEmail" placeholder="Email" />
                                        </div>
                                      </div>
                                      <div class="form-group">
                                        <label for="newPassword" class="col-sm-2 control-label">
                                                            Password</label>
                                        <div class="col-sm-10">
                                          <input type="password" class="form-control" id="newPassword" placeholder="Password" />
                                        </div>
                                      </div>
                                      <div class="row">
                                        <div class="col-sm-2">
                                        </div>
                                        <div class="col-sm-10">
                                          <button type="button" class="btn btn-primary btn-sm" id="signUpUser">
                                                                Submit</button>
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                        </div>
                                      </div>
                                    </form>
                                  </div>
                                </div>
                        </div>
                        

                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!--close login modal-->

    <div class="wrapper">
        <!--<div class="header">-->

        <!--</div>-->
        <!-- you can use the class main-raised if you want the main area to be as a page with shadows -->
        <div class="main">
            <div class="container">
                <div class="row">
                    <div class="navbar navbar-default navbar-fixed-top">
                        <div class="container">
                            <div class="header-icon"><img src="https://crowdsourcedscores.files.wordpress.com/2016/11/cropped-css-logo-footballleft-webres-1300px.jpg?w=520" alt="Crowdsourced Scores"></div>
                            <div class="navbar-header"><a href="/" class="navbar-brand"><span class="hidden-xs">Crowdsourced Scores</span><span class="visible-xs">CS Scores</span></a>
                            <button type="button" data-toggle="collapse" data-target="#navbar-main" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
                            </div>
                            <div id="navbar-main" class="navbar-collapse collapse">
                            <ul class="nav navbar-nav">
                                <li class="active"><a href="#">Home</a></li>
                                <li><a href="https://blog.crowdsourcedscores.com/" target="blog">Blog</a></li>
                                <li><a href="http://blog.crowdsourcedscores.com/2017-leaderboards/" target="leaderboard">Leaderboards</a></li>
                                <li class="dropdown">
                                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="podcasts"><i class="fa fa-headphones" aria-hidden="true"></i> Podcast<span class="caret"></span></a>
                                    <ul class="dropdown-menu">
                                        <li style="text-align: center">
                                            <a target="_blank" href="https://itunes.apple.com/us/podcast/the-crowd-wisdom-sports-podcast/id1331165617?mt=2" style="display:inline-block;overflow:hidden;background:url(https://linkmaker.itunes.apple.com/assets/shared/badges/en-us/podcast-lrg.svg) no-repeat;width:133px;height:34px;background-size:contain;"><span style="height: 34px; width:133px; padding: 16px 0"></span></a>
                                        </li>
                                        <li style="text-align: center">
                                            <a href="https://www.stitcher.com/s?fid=162919&refid=stpr"><img src="https://secureimg.stitcher.com/promo.assets/stitcher-banner-88x31.jpg" width="88" height="31" alt="Listen to Stitcher"></a>
                                        </li>
                                        <li style="text-align: center">
                                            <a target="_blank" href='https://playmusic.app.goo.gl/?ibi=com.google.PlayMusic&amp;isi=691797987&amp;ius=googleplaymusic&amp;apn=com.google.android.music&amp;link=https://play.google.com/music/m/Ikd4ilzctaypo3idfl2admka4ve?t%3DThe_Crowd_Wisdom_Sports_Podcast%26pcampaignid%3DMKT-na-all-co-pr-mu-pod-16' rel='nofollow'><img width='125px' alt='Listen on Google Play Music' src='https://play.google.com/intl/en_us/badges-music/images/badges/en_badge_web_music.png'/></a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="dropdown">
                                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="profileName"><span class="caret"></span></a>
                                    <ul class="dropdown-menu">
                                        <li style="text-align: center"><button type="button" class="btn btn-default" id="btn-logout">Logout</button></li>
                                    </ul>
                                </li>
                            </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row topRow">
                    <div class="col-xs-7 col-sm-10">
                        <!--<a href="https://crowdsourcedscores.auth.us-west-2.amazoncognito.com/login?response_type=token&client_id=2n15lhk845sucm0k4fejjqcbev&redirect_uri=https://crowdsourcedscores.com">Login</a>-->
                        
                        <div id="loginButtons"></div>


                        <!-- fieldset for Cognito -->
                        <!--<fieldset>
                            <legend>Sign Up for PCSM</legend>
                            User name: <input type="text" id="username" placeholder="Enter your preferred user name">
                            <br>
                            <br>
                            E-mail: <input type="text" id="email" placeholder="Enter your e-mail address">
                            <br>
                            <br>
                            Password: <input type="password" id="password" placeholder="Enter password">
                            <br>
                            <br>
                            <div style="width:500px;">
                                <button id="loginUser">Log In</button>
                            </div>
                            <ul id="loginUserResults"></ul>
                        </fieldset>-->

                        <select class="dropdown" id="seasonSelector">
                            <option value="2017" selected>2017</option>
                            <option value="2016">2016</option>
                        </select>
                        <h4>Select Week</h4>
                    </div>
                    <div class="col-xs-5 col-sm-2">
                        <a href="https://twitter.com/sourcedscores" class="twitter-follow-button" data-show-count="false">Follow @sourcedscores</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><br>
                        <iframe src="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Fcrowdsourcedscores&width=20px&layout=button_count&action=like&size=small&show_faces=false&share=true&height=46&appId=220211628373013" width="160px" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>

                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12 weekSelector">

                        <ul id="weekSelector" class="pagination pagination-info">
                            <li><a href="javascript:void(0);" data-week="1">1</a></li>
                            <li><a href="javascript:void(0);" data-week="2">2</a></li>
                            <li><a href="javascript:void(0);" data-week="3">3</a></li>
                            <li><a href="javascript:void(0);" data-week="4">4</a></li>
                            <li><a href="javascript:void(0);" data-week="5">5</a></li>
                            <li><a href="javascript:void(0);" data-week="6">6</a></li>
                            <li><a href="javascript:void(0);" data-week="7">7</a></li>
                            <li><a href="javascript:void(0);" data-week="8">8</a></li>
                            <li><a href="javascript:void(0);" data-week="9">9</a></li>
                            <li><a href="javascript:void(0);" data-week="10">10</a></li>
                            <li><a href="javascript:void(0);" data-week="11">11</a></li>
                            <li><a href="javascript:void(0);" data-week="12">12</a></li>
                            <li><a href="javascript:void(0);" data-week="13">13</a></li>
                            <li><a href="javascript:void(0);" data-week="14">14</a></li>
                            <li><a href="javascript:void(0);" data-week="15">15</a></li>
                            <li><a href="javascript:void(0);" data-week="16">16</a></li>
                            <li><a href="javascript:void(0);" data-week="17">17</a></li>
                            <li><a href="javascript:void(0);" data-week="18">WC</a></li>
                            <li><a href="javascript:void(0);" data-week="19">DIV</a></li>
                            <li><a href="javascript:void(0);" data-week="20">CONF</a></li>
                            <li><a href="javascript:void(0);" data-week="21">SB</a></li>
                            <li><i class="fa fa-bar-chart" aria-hidden="true" id="chartExpand"></i></li>
                        </ul>
                    </div>
                </div>




            <div class="row">
                <div class="col-xs-12 col-sm-9">


                    <div id="group">
                        <button id="joinGroup">Join PCSM Group</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var cognitoUser = userPool.getCurrentUser();
    console.log("cognitoUser: ", cognitoUser)
    var attributeList = [];

    var dataEmail = {
        Name : 'email',
        Value : 'email@mydomain.com'
    };

    var dataUsername = {
        Name : 'preferred_username',
        Value : 'email@mydomain.com'
    };
    var attributeEmail = new AmazonCognitoIdentity.CognitoUserAttribute(dataEmail);
    var attributeUsername = new AmazonCognitoIdentity.CognitoUserAttribute(dataUsername);
    // document.getElementById('loginUser').addEventListener('click', function () {
    //   userPool.signUp(document.getElementById('username').value, document.getElementById('password').value,
    //     attributeList, null,
    //     function (err, result) {
    //         if (err) {
    //             alert(JSON.stringify(err));
    //             return;
    //         }
    //         document.getElementById('signupUserResults').innerHTML = "Results: " + JSON.stringify(
    //           result.user, null, 2);
    //         cognitoUser = result.user;
    //         console.log(cognitoUser);
    //     });
    // });

    $("#loginUser").click(function() {
        login();
    });
    var login = function () {
        var email = $('#email').val();
        var authenticationData = {
            Username: email,
            Password: $('#password').val()
        };

        var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);
        var userData = {
            Username: email,
            Pool: userPool
        };
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
        cognitoUser.authenticateUser(authenticationDetails, {
            onSuccess: function () {
                $("#loginModal").modal("hide");
                showLogoutButton();
                getGameWeek(setGameWeek)
            },
            onFailure: function (err) {
<<<<<<< HEAD
                console.log(err.code);
                alert(JSON.stringify(err));
                if (err.code === "NotAuthorizedException") {
                    console.log("authorized error: ", cognitoUser)
                    showConfirmUI(cognitoUser);
                }

=======
                console.log(JSON.stringify(err))
                alert(JSON.stringify(err));
                if (err.code === "NotAuthorizedException") {
                    console.log(CognitoUser.resendConfirmationCode(email))
                    // CognitoUser.resendConfirmationCode(userData)
                    // .then(function(result) {
                    //     console.log(`Resend result ${result}`)
                    // })
                    // .catch(function(err) {
                    //     console.log(`Resend error: ${err}`)
                    // })
                    
                    //var tempUser = getUser();
                    //console.log(`tempUser = ${tempUser}`)
                }
>>>>>>> 267e48f934fb86a9ee863c2758b5adf6eec4e1da
            }
        });
    }



    // Commenting out and will remove once login flow is confirmed

    document.getElementById('signUpUser').addEventListener('click', function() {
        console.log('clicked');
        var attributeList = [];
        
        var dataEmail = {
                Name : 'email',
                Value : $('#newEmail').val()
            };

        var attributeEmail = new AmazonCognitoIdentity.CognitoUserAttribute(dataEmail);
        attributeList.push(attributeEmail);
        
        var dataFirst = {
                Name : 'given_name',
                Value : $('#firstName').val()
            };

        var attributeFirst = new AmazonCognitoIdentity.CognitoUserAttribute(dataFirst);
        attributeList.push(dataFirst);

        var dataLast = {
                Name : 'family_name',
                Value : $('#lastName').val()
            };

        var attributeFirst = new AmazonCognitoIdentity.CognitoUserAttribute(dataLast);
        attributeList.push(dataLast);

        // var dataUsername = {
        //         Name : 'username',
        //         Value : document.getElementById('newUsername').value()
        //     };

        // var attributeFirst = new AmazonCognitoIdentity.CognitoUserAttribute(dataUsername);
        // attributeList.push(dataUsername);

        // var dataPassword = {
        //         Name : 'password',
        //         Value : document.getElementById('newPassword').value()
        //     };

        // var attributeFirst = new AmazonCognitoIdentity.CognitoUserAttribute(dataPassword);
        // attributeList.push(dataPassword);

        var cognitoUser;

        userPool.signUp($('#newUsername').val(), $('#newPassword').val(), attributeList, null, function(err, result) {
            if (err) {
                alert(err);
                return;
            }
            cognitoUser = result.user;

            console.log('user name is ' + cognitoUser.getUsername());
            showConfirmUI(cognitoUser);
            confirmUser(cognitoUser);
        });
    });

    function showConfirmUI(cognitoUser) {
        $("#Registration").html("<h1>Welcome " + cognitoUser.getUsername() + "!</h1><p>We have sent a confirmation code to the email address that you provided.</p><div><label for=\"confirmUserCode\">Enter your confirmation code:</label><input type=\"number\" id=\"confirmUserCode\"><button class=\"btn btn-primary btn-sm\" id=\"confirmUser\" onclick=\"confirmUser('" + cognitoUser.getUsername() + "')\">Confirm</button></div>")
    }

    function confirmUser(username) {

        var userData = {
            Username: username,
            Pool: userPool
        };
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
        
        cognitoUser.getUserAttributeVerificationCode();

        // cognitoUser.confirmRegistration($("#confirmUserCode").val(), true, function(err, result) {
        //         if (err) {
        //             alert(JSON.stringify(err));
        //             return;
        //         }
        //         alert("result: ", JSON.stringify(result));
        //     });
    }


    function getAdvancedSecurityData(formReference) {
        if (typeof AmazonCognitoAdvancedSecurityData === "undefined") {
            return true;
        }

        // UserpoolId is not available on frontend for springboard. We do not use userPoolId
        // anyway other than put in context data. 
        var userPoolId = "";
        var clientId = getUrlParameter("client_id");

        var username = "";
        var usernameInput = document.getElementById("username");
        if (usernameInput && usernameInput.value) {
            username = usernameInput.value;
        }

        var asfData = AmazonCognitoAdvancedSecurityData.getData(username, userPoolId, clientId);
        if (typeof asfData === "undefined") {
            return true;
        }

        if (formReference && formReference.cognitoAsfData) {
            formReference.cognitoAsfData.value = asfData
        }

        return true;
    }

    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    };

</script>
</body>

</html>
