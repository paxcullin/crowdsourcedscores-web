<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/crowdsourcedscores-icon.png">
    <link rel="icon" type="image/png" href="assets/img/crowdsourcedscores-icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="description" content="Beating the sportsbooks with the Wisdom of the Crowd NFL Score Predictions">
    <meta name="keywords" content="football,crowdsourced,wisdom,wisdom of the crowd,sportsbook,spread,total,moneyline">
    <base href="https://crowdsourcedscores.com">

    <title>Admin - Crowd Wisdom Sports - Beating the Sportsbooks through Crowd Wisdom</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>

    <!--     Fonts and icons     -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">

    <!-- CSS Files -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="assets/css/material-kit.css" rel="stylesheet"/>
    <link href="assets/css/hopscotch.min.css" rel="stylesheet"/>
    <link href="assets/css/cws.css" rel="stylesheet"/>


    <!--   Core JS Files   -->
    <script src="assets/js/jquery.min.js" type="text/javascript"></script>
    <script src="assets/js/handlebars.runtime-v4.0.12.js" type="text/javascript"></script>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        
        ga('create', 'UA-69748662-2', 'auto');
        ga('send', 'pageview');
    </script>


    <script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="assets/js/material.min.js"></script>
    <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="assets/js/nouislider.min.js" type="text/javascript"></script>
    <script src="assets/js/hopscotch.min.js" type="text/javascript"></script>

    <!--  Plugin for the Datepicker, full documentation here: http://www.eyecon.ro/bootstrap-datepicker/ -->
    <script src="assets/js/bootstrap-datepicker.js" type="text/javascript"></script>

    <!-- Control Center for Material Kit: activating the ripples, parallax effects, scripts from the example pages etc -->
    <script src="assets/js/material-kit.js" type="text/javascript"></script>

    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>-->



    <!-- Handlebars.js -->
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.js"></script>
        <!--Cognito Code-->
        <script type="text/javascript" src="assets/js/amazon-cognito-identity.js"></script>
        <!--End Cognito Code-->
        <!--JWT Decode Script-->
        <script src="assets/js/jwt-decode.min.js"></script>
        <script src="assets/js/userAuth.js"></script>
        <!--End JWT Decode Script-->

        <script type="text/javascript">

        Handlebars.registerHelper('grouped_each', function(every, context, options) {
            var out = "", subcontext = [], i;
            if (context && context.length > 0) {
                for (i = 0; i < context.length; i++) {
                    if (i > 0 && i % every === 0) {
                        out += options.fn(subcontext);
                        subcontext = [];
                    }
                    subcontext.push(context[i]);
                }
                out += options.fn(subcontext);
            }
            return out;
        });

        Handlebars.registerHelper('ifCond', function (v1, operator, v2, options) {

            switch (operator) {
                case '==':
                    return (v1 == v2) ? options.fn(this) : options.inverse(this);
                case '===':
                    return (v1 === v2) ? options.fn(this) : options.inverse(this);
                case '!=':
                    return (v1 != v2) ? options.fn(this) : options.inverse(this);
                case '!==':
                    return (v1 !== v2) ? options.fn(this) : options.inverse(this);
                case '<':
                    return (v1 < v2) ? options.fn(this) : options.inverse(this);
                case '<=':
                    return (v1 <= v2) ? options.fn(this) : options.inverse(this);
                case '>':
                    return (v1 > v2) ? options.fn(this) : options.inverse(this);
                case '>=':
                    return (v1 >= v2) ? options.fn(this) : options.inverse(this);
                case '&&':
                    return (v1 && v2) ? options.fn(this) : options.inverse(this);
                case '||':
                    return (v1 || v2) ? options.fn(this) : options.inverse(this);
                default:
                    return options.inverse(this);
            }
        });

        Handlebars.registerHelper('dateCheck', function (startDateTime, options) {

            var now = new Date();
            var nowDateTimeDate = Date.parse(now);
            var startDateTimeDate = Date.parse(startDateTime);
            var cutoff = startDateTimeDate - 3600000;
            if (now < cutoff) {
                return options.fn(this);
            } else {
                return options.inverse(this);
            }
        });

        Handlebars.registerHelper('dateFormat', function (date) {
            var options = { month: 'short', day: 'numeric' };
            var dateObj = new Date(date).toLocaleString('en-US', options);

            return dateObj;
        });

        Handlebars.registerHelper('debug', function (the_string) {
            console.log(the_string, ": ", the_string);
        });
            </script>

    <script type="text/javascript" src="assets/js/template.game-admin.js"></script>
    <script src="https://www.google.com/jsapi" type="text/javascript"></script>

    <script>

        var getGameWeek = function (callback) {
            useToken(function(token) {
                console.log("getGameWeek token: ", token);
                var getGameWeekURL = "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/week";
                var getGameWeekURLOptions = {
                    method: "GET",
                    headers: {
                        'Authorization': token
                    }
                }
                if (token === false) {
                    getGameWeekURL = "https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/nfl/week/anon"
                    getGameWeekURLOptions = {
                        method: "GET"
                    }
                }
                get(getGameWeekURL, getGameWeekURLOptions)
                .then(function(response) {
                    return response.json();
                })
                .then(function (data) {
                    //data.year = 2017;
                    return callback(data);
                })
                .catch(function(err) {
                    console.log("Error: ", err);
                    return;
                });
            });
        };

        var formatGameTimes = function (games) {
            for (var i = 0; i < games.length; i++) {
                var gameDate = new Date(games[i].startDateTime);
                var options = { weekday: 'short', month: 'short', day: 'numeric', year: '2-digit', hour: 'numeric', minute: 'numeric', timeZoneName: 'short' };
                games[i].startDateTime = gameDate.toLocaleString('en-US', options);
            }
            return games;
        }


        // setting user weekly results
        var getWeeklyResults = function(data) {
            var myStraightUpResults = 0;
            var mySpreadResults = 0;
            var myTotalResults = 0;
            if (data && data.length > 0 && data[0].prediction) {
                for (i = 0; i < data.length; i++) {
                    if (data[i].prediction && data[i].prediction.results) {
                        $("#resultsContainer").css("display","block");
                        if (data[i].prediction.results.winner) {myStraightUpResults += data[i].prediction.results.winner;}
                        if (data[i].prediction.results.spread) {mySpreadResults += data[i].prediction.results.spread;}
                        if (data[i].prediction.results.total) {myTotalResults += data[i].prediction.results.total;}
                    }
                }
                $("#myStraightUpResults").text(myStraightUpResults);
                $("#mySpreadResults").text(mySpreadResults);
                $("#myTotalResults").text(myTotalResults);
            } else {
                $("#myResultsRow").hide();
            }
        }
        var getLeaderboards = function(data) {
            var myStraightUpResults = 0;
            var mySpreadResults = 0;
            var myTotalResults = 0;
            if (data && data.length > 0) {
                for (i = 0; i < data.length; i++) {
                    if (data[i].prediction && data[i].prediction.results) {
                        $("#resultsContainer").css("display","block");
                        if (data[i].prediction.results.winner) {myStraightUpResults += data[i].prediction.results.winner;}
                        if (data[i].prediction.results.spread) {mySpreadResults += data[i].prediction.results.spread;}
                        if (data[i].prediction.results.total) {myTotalResults += data[i].prediction.results.total;}
                    }
                }
                $("#myStraightUpResults").text(myStraightUpResults);
                $("#mySpreadResults").text(mySpreadResults);
                $("#myTotalResults").text(myTotalResults);
            }
        }

        var getWeeklyCrowdResults = function(crowdData) {
            var crowdStraightUpResults = 0;
            var crowdSpreadResults = 0;
            var crowdTotalResults = 0;
            if (crowdData && crowdData.length > 0) {
                for (i = 0; i < crowdData.length; i++) {
                    if (crowdData[i].crowd && crowdData[i].crowd.results) {
                        $("#resultsContainer").css("display","block");
                        if (crowdData[i].crowd.results.winner && crowdData[i].crowd.results.winner.correct) {crowdStraightUpResults += crowdData[i].crowd.results.winner.correct;}
                        if (crowdData[i].crowd.results.spread && crowdData[i].crowd.results.spread.correct) {crowdSpreadResults += crowdData[i].crowd.results.spread.correct;}
                        if (crowdData[i].crowd.results.total && crowdData[i].crowd.results.total.correct) {crowdTotalResults += crowdData[i].crowd.results.total.correct;}
                    }
                }
                $("#crowdStraightUpResults").text(crowdStraightUpResults);
                $("#crowdSpreadResults").text(crowdSpreadResults);
                $("#crowdTotalResults").text(crowdTotalResults);
            }
        }

        var setGameWeek = function (gameWeekData) {

            useToken(function(token) {
                if (!gameWeekData.sport) gameWeekData.sport = 'nfl';
                if (gameWeekData.sport === 'ncaaf') gameWeekData.week = 16;
                if (gameWeekData.sport === 'ncaam') { gameWeekData.week = 12; gameWeekData.year = 2019; }
                var setGameWeekURL = `https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/${gameWeekData.sport}/${gameWeekData.year}/${gameWeekData.season}/${gameWeekData.week}/games`;
                var setGameWeekGetOptions = 
                    {     
                        method: "GET",
                        headers: {
                                'Authorization': token
                        }
                    }
                    // creating anonymous API call for games
                if (token === false) {
                    setGameWeekURL = `https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/${gameWeekData.sport}/${gameWeekData.year}/${gameWeekData.season}/${gameWeekData.week}/games/anon`;
                    setGameWeekGetOptions = {     
                        method: "GET"
                    }
                }

                var userGroups = (function () {
                        cognitoUser.getSession(function (err, session) {
                            if (err) {
                                //window.location = '/';
                                console.log("getSession err = ", JSON.stringify(err))
                                return;
                            }
                            console.log("session.getIdToken(): ", session.getIdToken())
                            var userGroupsArray = session.getIdToken().payload["cognito:groups"];
                            if (userGroupsArray.indexOf("admins") === -1) {
                                window.location = '/';
                                return false;
                            }
                            return userGroupsArray;
                        })
                    })();
                    console.log("userGroups: ", userGroups)
                get(setGameWeekURL, setGameWeekGetOptions)
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                        $("#games-loading-icon").css("display","none")

                        formatGameTimes(data.games);
                        var games = {games: data.games};
                        console.log("games: ", games)
                        
                        
                        var gamesRenderer = Handlebars.templates['template.game-admin'];
                        var gamesResult = gamesRenderer(games);

                        $('#games').html(gamesResult);

      
                        //drawChart2(year, week);
                        $('.prediction-btn').on('click', function (e) {
                            e.preventDefault();
                            $(this).text('Saving...');
                            var newPrediction = true;
                            var $game = $(this).parents('.prediction');
                            var game = {
                                gameId: parseInt($game.attr('data-game-id')),
                                gameWeek: parseInt($game.attr('data-game-week')),
                                year: parseInt($game.attr('data-game-year')),
                                status: $("#" + parseInt($game.attr('data-game-id')) + "-gameStatus").val(),
                                sport: $game.attr('data-game-sport'),
                                startDateTime: Date.parse($game.find('.startDateTime').val()),
                                season: $game.attr('data-game-season'),
                                results: {
                                    awayTeam: {
                                        score: -1
                                    },
                                    homeTeam: {
                                        score: -1
                                    }
                                },
                                odds: {
                                    spread: parseFloat($game.find('.odds-spread input').val()),
                                    total: parseFloat($game.find('.odds-total input').val())
                                }
                            };


                            var btn = $(this);
                            var gameElm = $('#games').find("[data-game-id='" + game.gameId + "']");
                            var messageElm = gameElm.find(".prediction-message");
                            
                            
                            var awayTeamScore = $game.find('.away-team-score input').val();
                            var homeTeamScore = $game.find('.home-team-score input').val();
                            var spread = $game.find('.odds-spread input').val();
                            var total = $game.find('.odds-total input').val();

                            var away = $game.attr('data-away-team');
                            var home = $game.attr('data-home-team');

                            var awayCode = $game.attr('data-away-code');
                            var homeCode = $game.attr('data-home-code');

                            if (awayTeamScore && homeTeamScore) {
                                game.results.awayTeam.score = parseInt(awayTeamScore);
                                game.results.homeTeam.score = parseInt(homeTeamScore);
                            }


                            //submitPrediction(prediction, $(this));
                            useToken(function(token){
                                console.log("game update: ", game)
                                get("https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/gameupdate",{
                                    method: "POST",
                                    headers: {
                                        Authorization: token,
                                        "Content-type": "application/json"
                                    },
                                    body: JSON.stringify(game)
                                })
                                .then(function(response) {
                                    //console.log("response message:", response)
                                    switch(response.status) {
                                        case 200:
                                            console.log("200: ", response);
                                            btn.text('Predict');
                                            var messageHtml = response;
                                            //messageHtml = statusMessage('success', response.data.message);
                                            //messageElm.html(messageHtml)
                                            $game.find('.gameHeaderPredicted').append("<i class=\"fa fa-check-circle\"></i>")
                                            //console.log("response.data.updated: ", response.data.updated)
                                            //if (response.data.predictionsSubmitted > -1) updateProgressBar(response.data.predictionsSubmitted, totalGames);
                                            //moveBoxes(prediction.gameId);
                                            return;
                                        case 400:
                                            //var errorObj = JSON.parse(response.responseText);
                                            console.log("400: ", response);
                                            btn.text('Predict');
                                            // var messageHtml = statusMessage('danger', errorObj.message);
                                            // messageElm.html(messageHtml);
                                            return;
                                        case 500:
                                            var errorObj = JSON.parse(response.responseText);
                                            console.log("500: ", errorObj);
                                            btn.text('Predict');
                                            var messageHtml = statusMessage('danger', errorObj.message);
                                            messageElm.html(messageHtml);
                                            return;
                                    }
                                    return true;
                                })
                                .catch(function(reject) {
                                    console.log("reject message: ", reject)
                                })
                            })
                            // Update prediction table cell
                            //$('#' + awayCode + '-prediction').text(prediction.awayTeam.score);
                            //$('#' + homeCode + '-prediction').text(prediction.homeTeam.score);
                            // $('#' + awayCode + homeCode + '-total-prediction').text(prediction.awayTeam.score + prediction.homeTeam.score);
                            // $('#' + awayCode + homeCode + '-spread-prediction').text(prediction.awayTeam.score - prediction.homeTeam.score);
                            //show odds and crowd info
                        });
                        return data;
                    })
                    .catch(function (jqXHR, textStatus, errorThrown) {
                        console.log("Error getting games: ", jqXHR, textStatus, errorThrown);
                    })
            });
        };

        //jQuery for animating boxes after they're predicted

            function moveBoxes(gameId) {
                $("#container-" + gameId).animate({opacity: '0.1'}, 1500, function() {
                    var predictedGame = $("#container-" + gameId).detach();
                    $("#lastRow").append(predictedGame);
                });
                $("#container-" + gameId).animate({opacity: '1.0'}, 1500);
            }

        var submitPrediction = function (prediction, btn) {
            useToken(function(token) {
                //console.log("prediction: ", JSON.stringify(prediction))
                var setSubmitPredictionsOptions = 
                        {     
                            method: "POST",
                            headers: {
                                    'Authorization': token
                            },
                            body: prediction
                        }
                    get("https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/predictions",setSubmitPredictionsOptions)
                    .then(function(response) {
                        switch(response.status) {
                            case "200":
                                console.log("200: ", response);
                                btn.text('Predict');
                                var messageHtml = statusMessage('success', response.message);
                                messageElm.html(messageHtml)
                                updateProgressBar(userInformation.predictionsSubmitted, totalGames)
                                moveBoxes(prediction.gameId);
                            case "400":
                                var errorObj = JSON.parse(response.responseText);
                                console.log("400: ", errorObj);
                                btn.text('Predict');
                                var messageHtml = statusMessage('danger', errorObj.message);
                                messageElm.html(messageHtml);
                            case "500":
                                var errorObj = JSON.parse(response.responseText);
                                console.log("500: ", errorObj);
                                btn.text('Predict');
                                var messageHtml = statusMessage('danger', errorObj.message);
                                messageElm.html(messageHtml);

                        }
                    });
                var predictionElm = $('#games').find("[data-game-id='" + prediction.gameId + "']");
                var messageElm = predictionElm.find(".prediction-message");
                // ,
                //             statusCode: {
                //             }
            });
        };

        var statusMessage = function (type, message) {
            var icon = type === 'success' ? 'check' : 'error_outline';
            var head = type === 'success' ? 'Success' : 'Error';
            return '<div class="alert alert-' + type + '" style="padding:5px;"> \
                                <div class="container-fluid"> \
                                <div class="alert-icon"> \
                                <i class="material-icons">' + icon + '</i> \
                                </div> \
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close"> \
                                <span aria-hidden="true"><i class="material-icons">clear</i></span> \
                                </button> \
                                <b>' + head + '</b> ' + message + '\
                        </div> \
                        </div>';
        };

        var getUserProfile = function (id_token, callback) {
            lock.getProfile(id_token, function (err, profile) {
                if (err) {
                    return callback('There was an error getting the profile: ' + err.message);
                }

                return callback(null, profile);
            });
        };

        var setUserProfile = function (profile) {
            // Display user information in the UI somewhere

            // Used for editing
            var user_id = profile.user_id;
            // ...
            //document.getElementById('avatar').src = profile.picture;

        };

        var gameWeekData = {};
        $(document).ready(function () {

            if (cognitoUser) {
                showLogoutButton();
            } else {
                showLoginButton();
            }
            // get('/assets/js/handlebars.nav.hbs')
            // .then((navTemplate) => {
            //     console.log('navTemplate: ', navTemplate)
            //     var template = navTemplate.innerHTML;
            //     console.log('template: ', template)
            //     var templateScript = Handlebars.compile(template);
            //     var html = templateScript();
            //     $("navRow").html(template());
            // });




            setTimeout(function () {
                getGameWeek(function (data) {
                    if (data) {
                        week = data.week;
                        if (document.getElementById('seasonSelector')) { 
                            year = parseInt(document.getElementById('seasonSelector').value);
                        }
                        data.sport = getUrlParameter('sport');
                        if (data.year) {
                            year = data.year;
                        }
                        if (data.sport === '') data.sport = 'nfl';
                        gameWeekData = data;
                        
                        var sportSpecificNavResult = sportSpecificNavRenderer({sport: gameWeekData.sport});
                        $("#sportSpecificNavRow").html(sportSpecificNavResult);
                        
                        var $selectorElm = $('*[data-week="' + week + '"]');
                        $selectorElm.parent('li').addClass('active');
                        $('#weekSelector li').on('click', 'a', function () {
                            gameWeekData.year = parseInt(document.getElementById('seasonSelector').value);
                            if (!gameWeekData.year) {
                                gameWeekData.year = 2018;
                            }
                            gameWeekData.week = parseInt($(this).attr('data-week'));
                            $("#games-loading-icon").css("display","block")
                            $('#weekSelector li').removeClass('active');
                            $('#resultsContainer').css('display','none');
                            $(this).parent('li').addClass('active');
                            setGameWeek(gameWeekData);
                            //deferredLeaderboardRequest2(gameWeekData.year, gameWeekData.week, id_token, buildChart);
                        });
                        setGameWeek(data);
                        //deferredLeaderboardRequest2(year, week, id_token, buildChart);
                    }
                });
            }, 1000);
        });

        function logout () {
            var cognitoUser = userPool.getCurrentUser();
            ga('send','event','login','logout');
            cognitoUser.signOut();
            showLoginButton();
            window.location = '/';
        };
    </script>

</head>

    <body>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0&appId=1562547140702907&autoLogAppEvents=1';
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    <!-- Navbar will come here -->

    <!-- end navbar -->

<div class="wrapper">
        <!--<div class="header">-->

        <!--</div>-->
        <!-- you can use the class main-raised if you want the main area to be as a page with shadows -->
    <div class="main">
        <div class="container">
            <div id="navRow"></div>
            <div class="row topRow">
                <div class="col-xs-12">
                    <a href="https://twitter.com/sourcedscores" class="twitter-follow-button" data-show-count="false">Follow @sourcedscores</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><br>
                    <iframe src="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.facebook.com%2Fcrowdsourcedscores&width=20px&layout=button_count&action=like&size=small&show_faces=false&share=true&height=46&appId=220211628373013" width="160px" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"></iframe>

                </div>
            </div>
            <div id="sportSpecificNavRow">
                
            </div>
        </div>

            <div class="row">
                <div class="col-sm-12 col-md-8">
                    <div id="games-loading-icon">
                        <i class="fa fa-cog fa-spin fa-3x fa-fw"></i>
                        <span class="sr-only">Loading...</span>
                    </div>

                    <div id="games"></div>
                </div>
            </div>
            <div class="row">
                    <button id="customButton">Purchase</button>
                <div class="col-sm-12" style="font-size: 0.8em">
                    All odds are provided by <a href="https://www.oddsshark.com" target="_blank">Oddsshark.com</a> and are locked one hour prior to kickoff.
                </div>
            </div>
            <!-- <form action="https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/stripe/payment" method="POST">
                <script
                    src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                    data-key="pk_test_r5luAfe73gRWHjEWSaVYMHBr"
                    data-amount="999"
                    data-name="Crowd Wisdom Sports"
                    data-description="Example charge"
                    data-image="https://stripe.com/img/documentation/checkout/marketplace.png"
                    data-locale="auto">
                </script>
            </form> -->
            <!-- <form class="my-form" method="post">
                <input type="hidden" name="token" id="token">
                <label>
                  <span>First Name</span>
                  <input class="inp-first-name" name="first_name">
                </label>
                <label>
                  <span>Last Name</span>
                  <input class="inp-last-name" name="last_name">
                </label>
                <fieldset>
                  <legend>Address</legend>
                  <label>
                    <span>Street Address Line 1</span>
                    <input class="inp-street-address1" name="street_address1">
                  </label>
                  <label>
                    <span>City</span>
                    <input class="inp-city" name="city">
                  </label>
                  <label>
                    <span>State</span>
                    <input class="inp-state" name="state">
                  </label>
                  <label>
                    <span>Postal Code</span>
                    <input class="inp-zip" name="zip">
                  </label>
                </fieldset>
                <button>Submit</button>
              </form> -->
        </div>
    </div>
</div>
<script src="https://checkout.stripe.com/checkout.js"></script>
<script>
    var cognitoUser = userPool.getCurrentUser();
    var attributeList = [];

    var dataEmail = {
        Name : 'email',
        Value : 'email@mydomain.com'
    };

    var dataUsername = {
        Name : 'preferred_username',
        Value : 'email@mydomain.com'
    };
    var attributeEmail = new AmazonCognitoIdentity.CognitoUserAttribute(dataEmail);
    var attributeUsername = new AmazonCognitoIdentity.CognitoUserAttribute(dataUsername);
    // document.getElementById('loginUser').addEventListener('click', function () {
    //   userPool.signUp(document.getElementById('username').value, document.getElementById('password').value,
    //     attributeList, null,
    //     function (err, result) {
    //         if (err) {
    //             alert(JSON.stringify(err));
    //             return;
    //         }
    //         document.getElementById('signupUserResults').innerHTML = "Results: " + JSON.stringify(
    //           result.user, null, 2);
    //         cognitoUser = result.user;
    //         console.log(cognitoUser);
    //     });
    // });

    $("#loginUser").click(function() {
        login();
    });
    var login = function () {
        var email = $('#email').val();
        var authenticationData = {
            Username: email,
            Password: $('#password').val()
        };

        var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);
        var userData = {
            Username: email,
            Pool: userPool
        };
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
        cognitoUser.authenticateUser(authenticationDetails, {
            onSuccess: function () {
                $("#loginModal").modal("hide");
                showLogoutButton();
                getGameWeek(setGameWeek)
            },
            onFailure: function (err) {
                console.log(JSON.stringify(err))
                alert(JSON.stringify(err));
                if (err.code === "NotAuthorizedException") {
                    console.log(CognitoUser.resendConfirmationCode(email))
                    // CognitoUser.resendConfirmationCode(userData)
                    // .then(function(result) {
                    //     console.log(`Resend result ${result}`)
                    // })
                    // .catch(function(err) {
                    //     console.log(`Resend error: ${err}`)
                    // })
                    
                    //var tempUser = getUser();
                    //console.log(`tempUser = ${tempUser}`)
                }
            }
        });
    }

    function showConfirmUI(cognitoUser) {
        $("#loginRegistrationColumn").html("<h1>Welcome " + cognitoUser.getUsername() + "!</h1><p>We have sent a confirmation code to the email address that you provided.</p><div><label for=\"confirmUserCode\">Enter your confirmation code:</label><input type=\"number\" id=\"confirmUserCode\"><button class=\"btn btn-primary btn-sm\" id=\"confirmUser\" onclick=\"confirmUser('" + cognitoUser.getUsername() + "')\">Confirm</button><br><a href=\"#\" id=\"resendCode\" onclick=\"resetVerificationPIN('" + cognitoUser.getUsername() + "')\">Resend Confirmation Code</a></div>")
    }


    function confirmUser(username) {

        var userData = {
            Username: username,
            Pool: userPool
        };
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
        
        cognitoUser.confirmRegistration($('#confirmUserCode').val(), true, function (err, results) {
            if (err) {
                alert(err);
            } else {
                window.location = '/';
            }
        });
    };

    
    function resetVerificationPIN(username){
        const p = new Promise((res, rej)=>{
        
        var userData = {
            Username: username,
            Pool: userPool
        };
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

        cognitoUser.resendConfirmationCode(function(err, result) {
            if (err) {
                rej(err)
                return
            }
                res()
            })
        });
    };

    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    };

    function showForgotPasswordUI() {
        $("#loginRegistrationColumn").html("<div>Please provide your e-mail address and, if it exists in our system, we will send you a link to reset your password.<br><label for=\"forgotPasswordEmail\">Enter your e-mail address:</label><input type=\"email\" id=\"forgotPasswordEmail\"><button class=\"btn btn-primary btn-sm\" id=\"forgotPasswordButton\" onclick=\"forgotPassword()\">Reset Password</button><br></div>")
    }


    function forgotPassword() { 

        var forgotPasswordEmail = $('#forgotPasswordEmail').val()
        var userData = {
            Username: forgotPasswordEmail,
            Pool: userPool
        };
        var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

        cognitoUser.forgotPassword({
            onSuccess: function (result) {
                console.log('call result: ' + result);
                $("#loginRegistrationColumn").html("<div>Enter the confirmation code sent to the e-mail address you provided and your new password.<br><label for=\"forgotPasswordConfirmationCode\">Confirmation Code:</label><input type=\"number\" id=\"forgotPasswordConfirmationCode\"><br><label for=\"forgotPasswordNewPassword\">New Password</label><input type=\"password\" id=\"forgotPasswordNewPassword\"><button class=\"btn btn-primary btn-sm\" id=\"changePasswordButton\" onclick=\"inputVerificationCode('" + forgotPasswordEmail + "')\">Reset Password</button><br></div>")
            },
            onFailure: function(err) {
                console.log(JSON.stringify(err));
            }
        });
    };

    function inputVerificationCode(userEmail) {
        var userData = {
            Username: userEmail,
            Pool: userPool
        }
    var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
        var verificationCode = $('#forgotPasswordConfirmationCode').val();
        var newPassword = $('#forgotPasswordNewPassword').val();
        
        cognitoUser.confirmPassword(verificationCode, newPassword, {
            onFailure(err) {
                console.log(err);
            },
            onSuccess() {
                $("#loginRegistrationColumn").html("<form role=\"form\" class=\"form-horizontal\"><div class=\"form-group\"><fieldset>E-mail: <input type=\"text\" id=\"email\" placeholder=\"Enter your e-mail address\"><br><br>Password: <input type=\"password\" id=\"password\" placeholder=\"Enter password\"><br><a href=\"#\" onClick=\"showForgotPasswordUI()\">Forgot Password?</a><br><ul id=\"loginUserResults\"></ul><div class=\"fb-login-button\" data-show-faces=\"false\" data-width=\"200\" data-max-rows=\"1\"></div></fieldset></div></form><div class=\"modal-footer\"><button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button><button type=\"button\" class=\"btn btn-primary\" id=\"loginUser\" onclick=\"login()\">Login</button><br></div>");
            }
        });
    }


</script>
    <script type="text/javascript" src="assets/js/lib/axios/dist/axios.standalone.js"></script>
    <script type="text/javascript" src="assets/js/lib/CryptoJS/rollups/hmac-sha256.js"></script>
    <script type="text/javascript" src="assets/js/lib/CryptoJS/rollups/sha256.js"></script>
    <script type="text/javascript" src="assets/js/lib/CryptoJS/components/hmac.js"></script>
    <script type="text/javascript" src="assets/js/lib/CryptoJS/components/enc-base64.js"></script>
    <script type="text/javascript" src="assets/js/lib/url-template/url-template.js"></script>
    <script type="text/javascript" src="assets/js/lib/apiGatewayCore/sigV4Client.js"></script>
    <script type="text/javascript" src="assets/js/lib/apiGatewayCore/apiGatewayClient.js"></script>
    <script type="text/javascript" src="assets/js/lib/apiGatewayCore/simpleHttpClient.js"></script>
    <script type="text/javascript" src="assets/js/lib/apiGatewayCore/utils.js"></script>
    <script type="text/javascript" src="assets/js/apigClient.js"></script>
    <script type="text/javascript">
    
    var apiClient = apigClientFactory.newClient();
    
    </script>

    <script type="text/javascript" src="assets/js/index.js"></script>
    <script type="text/javascript" src="assets/js/template.nav.js"></script>
    <script type="text/javascript" src="assets/js/template.sportSpecificNav.js"></script>
    <script type="text/javascript">
        var navRenderer = Handlebars.templates['template.nav'];
        var navResult = navRenderer({userInformation: userInformation, sport: gameWeekData.sport});
        $("#navRow").html(navResult);

        
        var sportSpecificNavRenderer = Handlebars.templates['template.sportSpecificNav'];
        if (!gameWeekData || !gameWeekData.sport) {
            gameWeekData.sport = 'nfl';
        }
    </script>
    <script type="text/javascript">
        // const stripe = Stripe('pk_test_r5luAfe73gRWHjEWSaVYMHBr');
        // const myForm = document.querySelector('.my-form');
        // myForm.addEventListener('submit', handleForm);
        
        // function handleForm(event) {
        //     event.preventDefault();
                var handler = StripeCheckout.configure({
                    key: 'pk_test_r5luAfe73gRWHjEWSaVYMHBr',
                    image: 'https://stripe.com/img/documentation/checkout/marketplace.png',
                    locale: 'auto',
                    token: function(token) {
                        // You can access the token ID with `token.id`.
                        // Get the token ID to your server-side code for use.
                        useToken(function(idToken) {
                            if (!idToken) { return false; }
                            get('https://y5f8dr2inb.execute-api.us-west-2.amazonaws.com/dev/stripe/payment', {
                                method: 'POST',
                                headers: {
                                    Authorization: idToken,
                                    'Content-type': 'application/json'
                                },
                                body: JSON.stringify({token: token, accessToken: cognitoUser.signInUserSession.getAccessToken()})
                            })
                            .then((response) => {
                                console.log('response: ', response);
                                return response.json();
                            })
                            .then((responseJSON) => {
                                console.log('responseJSON: ', responseJSON)
                                if (responseJSON.status === 'succeeded') {
                                    $('#customButton').hide();
                                } else {
                                    $('#customButton').text('Error: ' + responseJSON.status);
                                }
                            })
                            .catch((err) => { console.log('err :', err);});
                        })
                    }
                });

                document.getElementById('customButton').addEventListener('click', function(e) {
                    useToken(function(token) {
                        if (!token) {
                            $('.my-form-error').text('Please sign in and try again.');
                            return;
                        }
                        // Open Checkout with further options:
                        handler.open({
                            name: 'Crowd Wisdom Sports',
                            description: 'College Bowl Crowd Predictions',
                            amount: 1999,
                            description: 'Get access to the Crowd Predictions for all remaining College Bowl Games!',
                            zipCode: true,
                            billingAddress: true,
                            email: userInformation.attributes.email
                        });
                        e.preventDefault();
                    });
                });

                // Close Checkout on page navigation:
                window.addEventListener('popstate', function() {
                    handler.close();
                });
    </script>
</body>

</html>
